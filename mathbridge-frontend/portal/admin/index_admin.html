<!-- /index.html -->
<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>MathBridge Admin – Scarlet Bridge (Light Minimal)</title>

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet"/>

    <!-- Lucide icons -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <!-- App stylesheet -->
    <link rel="stylesheet" href="css/admin.css" />
</head>
<body>
<div class="app">
    <!-- Header -->
    <header class="app-header" role="banner">
        <div class="left">
            <button class="icon-btn" id="sidebarToggle" aria-label="Thu gọn/Mở rộng sidebar" title="Thu gọn/Mở rộng sidebar">
                <i data-lucide="panel-left-close" aria-hidden="true"></i>
            </button>

            <a class="brand" href="#" aria-label="MathBridge Admin">
                <i data-lucide="bridge" class="brand-icon" aria-hidden="true"></i>
                <span class="brand-text">MathBridge Admin</span>
            </a>
        </div>

        <div class="center">
            <form class="search" role="search" aria-label="Tìm kiếm nhanh">
                <i data-lucide="search" aria-hidden="true"></i>
                <input id="globalSearch" type="search" placeholder="Tìm học viên, gia sư, hợp đồng…" aria-label="Ô tìm kiếm" autocomplete="off"/>
            </form>
        </div>

        <div class="right">
            <div class="profile">
                <button class="profile-btn" id="profileBtn" aria-haspopup="true" aria-expanded="false">
                    <img class="avatar" src="https://i.pravatar.cc/40?img=13" alt="Avatar người dùng" />
                    <span class="hide-sm">Admin</span>
                    <i data-lucide="chevron-down" aria-hidden="true"></i>
                </button>
                <div class="menu" id="profileMenu" role="menu" aria-label="Menu hồ sơ">
                    <a href="#" role="menuitem"><i data-lucide="user"></i>Hồ sơ</a>
                    <a href="#" role="menuitem"><i data-lucide="settings"></i>Cài đặt</a>
                    <hr />
                    <a href="#" role="menuitem"><i data-lucide="log-out"></i>Đăng xuất</a>
                </div>
            </div>
        </div>
    </header>

    <div class="shell">
        <!-- Sidebar -->
        <aside class="sidebar" id="sidebar" aria-label="Điều hướng chính">
            <nav class="nav">
                <a class="nav-item active" href="index_admin.html" data-key="dashboard" title="Dashboard">
                    <i data-lucide="layout-dashboard"></i><span>Dashboard</span>
                </a>
                <a class="nav-item" href="Teacher_admin.html" data-key="lecturers" title="Giảng Viên">
                    <i data-lucide="graduation-cap"></i><span>Giảng Viên</span>
                </a>
                <a class="nav-item" href="LopHoc.html" data-key="classes" title="Lớp Học">
                    <i data-lucide="layers"></i><span>Lớp Học</span>
                </a>
                <a class="nav-item" href="#" data-key="contracts" title="Hợp đồng">
                    <i data-lucide="file-text"></i><span>Hợp đồng</span>
                </a>
                <a class="nav-item" href="#" data-key="revenue" title="Doanh thu">
                    <i data-lucide="badge-dollar-sign"></i><span>Doanh thu</span>
                </a>
                <a class="nav-item" href="#" data-key="curriculums" title="Chương Trình Học">
                    <i data-lucide="book-open-text"></i><span>Chương Trình Học</span>
                </a>

                <div class="nav-sep" role="separator" aria-hidden="true"></div>
                <a class="nav-item" href="#" data-key="students" title="Học viên">
                    <i data-lucide="users"></i><span>Học viên</span>
                </a>
                <a class="nav-item" href="#" data-key="parents" title="Phụ huynh">
                    <i data-lucide="contact"></i><span>Phụ huynh</span>
                </a>
                <a class="nav-item" href="#" data-key="campus" title="Cơ sở &amp; Phòng học">
                    <i data-lucide="building-2"></i><span>Cơ sở &amp; Phòng học</span>
                </a>
                <a class="nav-item" href="#" data-key="rbac" title="Quyền &amp; Tài khoản">
                    <i data-lucide="shield-check"></i><span>Quyền &amp; Tài khoản</span>
                </a>
                <a class="nav-item" href="#" data-key="settings" title="Cài đặt">
                    <i data-lucide="sliders-horizontal"></i><span>Cài đặt</span>
                </a>
                <a class="nav-item" href="#" data-key="audit" title="Lịch sử / Audit Logs">
                    <i data-lucide="clock-9"></i><span>Lịch sử / Audit Logs</span>
                </a>
            </nav>
        </aside>

        <!-- Main -->
        <main class="main" id="main" role="main">
            <!-- KHUNG TRẮNG BO TRÒN GÓI TOÀN BỘ DASHBOARD -->
            <section class="dash-card" aria-label="Dashboard content">
                <!-- Bộ lọc -->
                <div class="filters filters-inline" aria-label="Bộ lọc">
                    <div class="filters-row">
                        <div class="form-field">
                            <label>Kiểu lọc</label>
                            <div class="seg-group" role="tablist" aria-label="Kiểu lọc">
                                <button class="seg active" role="tab" aria-selected="true" data-mode="grade">
                                    <i data-lucide="list-checks"></i><span class="hide-sm">Theo lớp</span><span class="show-sm">Lớp</span>
                                </button>
                                <button class="seg" role="tab" aria-selected="false" data-mode="cert">
                                    <i data-lucide="medal"></i><span class="hide-sm">Luyện chứng chỉ</span><span class="show-sm">Chứng chỉ</span>
                                </button>
                            </div>
                        </div>

                        <div class="form-field" id="fieldGrade">
                            <label for="gradeSelect">Lớp</label>
                            <select id="gradeSelect" aria-label="Chọn lớp">
                                <option value="all">Tất cả</option>
                                <option value="9">Lớp 9</option>
                                <option value="10">Lớp 10</option>
                                <option value="11">Lớp 11</option>
                                <option value="12">Lớp 12</option>
                            </select>
                        </div>

                        <div class="form-field" id="fieldCert" hidden>
                            <label for="certSelect">Chứng chỉ</label>
                            <select id="certSelect" aria-label="Chọn chứng chỉ">
                                <option value="all">Tất cả</option>
                                <option value="IGCSE">IGCSE</option>
                                <option value="A-Level">A-Level</option>
                                <option value="IB">IB</option>
                                <option value="AP">AP</option>
                                <option value="SAT">SAT</option>
                            </select>
                        </div>

                        <div class="form-field">
                            <label for="campusSelect">Cơ sở</label>
                            <select id="campusSelect" aria-label="Chọn cơ sở">
                                <option value="all">Tất cả</option>
                                <option value="1">Cơ sở 1</option>
                                <option value="2">Cơ sở 2</option>
                            </select>
                        </div>

                        <div class="form-field">
                            <label for="monthPicker">Theo tháng</label>
                            <input id="monthPicker" type="month" aria-label="Chọn tháng"/>
                        </div>

                        <div class="filters-actions">
                            <button id="clearBtn" class="btn ghost" aria-label="Xoá bộ lọc">
                                <i data-lucide="x-circle"></i><span>Xoá lọc</span>
                            </button>
                        </div>
                    </div>
                </div>

                <!-- KPI 4 chỉ số -->
                <section class="kpi-grid kpi-4" aria-label="Tổng quan">
                    <article class="card kpi">
                        <div class="kpi-head">
                            <div class="kpi-icon"><i data-lucide="users"></i></div>
                            <span class="kpi-label">Tổng học sinh</span>
                        </div>
                        <div class="kpi-main">
                            <div class="kpi-value" id="totalStudents">—</div>
                        </div>
                    </article>

                    <article class="card kpi">
                        <div class="kpi-head">
                            <div class="kpi-icon"><i data-lucide="square-user"></i></div>
                            <span class="kpi-label">Tổng giáo viên</span>
                        </div>
                        <div class="kpi-main">
                            <div class="kpi-value" id="totalTeachers">—</div>
                        </div>
                    </article>

                    <article class="card kpi">
                        <div class="kpi-head">
                            <div class="kpi-icon"><i data-lucide="layers-3"></i></div>
                            <span class="kpi-label">Tổng Lớp Học</span>
                        </div>
                        <div class="kpi-main">
                            <div class="kpi-value" id="totalClasses">—</div>
                        </div>
                    </article>

                    <article class="card kpi">
                        <div class="kpi-head">
                            <div class="kpi-icon"><i data-lucide="dollar-sign"></i></div>
                            <span class="kpi-label">Tổng Doanh Thu</span>
                        </div>
                        <div class="kpi-main">
                            <div class="kpi-value" id="totalRevenue">—</div>
                        </div>
                    </article>
                </section>

                <!-- VÙNG NỘI DUNG CHÍNH (FULL CÒN LẠI MÀN HÌNH) -->
                <div class="content" id="content" aria-label="Nội dung chính Dashboard">
                    <article class="card content-panel">
                        <div class="card-head">
                            <h3>Nội dung Dashboard</h3>
                        </div>
                        <div class="card-body content-body">
                            <div class="empty-lg">
                                <i data-lucide="layout-grid"></i>
                                <p>Chưa có nội dung. Bạn có thể thêm biểu đồ/bảng ở đây.</p>
                            </div>
                        </div>
                    </article>
                </div>
                <!-- /content -->
            </section>
            <!-- /dash-card -->
        </main>
    </div>
</div>

<!-- ============ JS (auto-apply filters) ============ -->
<script>
    const $ = (s, c=document)=>c.querySelector(s);
    const $$ = (s, c=document)=>Array.from(c.querySelectorAll(s));
    const fmtMoney = n => n.toLocaleString('vi-VN') + ' ₫';

    // Sidebar toggle
    $('#sidebarToggle').addEventListener('click', ()=> document.body.classList.toggle('sidebar-collapsed'));

    // Profile menu
    $('#profileBtn').addEventListener('click', ()=> $('#profileMenu').classList.toggle('open'));
    document.addEventListener('click', (e)=>{ if(!e.target.closest('.profile')) $('#profileMenu').classList.remove('open'); });

    // -------- Mock data (để KPI phản hồi theo bộ lọc) --------
    const data = [
      {kind:'student', grade:'9', campus:'1', date:'2025-10-02'},
      {kind:'student', grade:'10', campus:'1', date:'2025-10-03'},
      {kind:'student', grade:'11', campus:'2', date:'2025-10-07'},
      {kind:'student', grade:'12', campus:'2', date:'2025-09-28'},
      {kind:'student', cert:'IGCSE', campus:'1', date:'2025-10-04'},
      {kind:'student', cert:'A-Level', campus:'2', date:'2025-10-08'},
      {kind:'student', cert:'SAT', campus:'1', date:'2025-10-12'},
      {kind:'teacher', grade:'9', campus:'1', date:'2025-10-01'},
      {kind:'teacher', grade:'10', campus:'2', date:'2025-10-05'},
      {kind:'teacher', cert:'IB', campus:'2', date:'2025-10-06'},
      {kind:'class', grade:'11', campus:'1', date:'2025-10-10'},
      {kind:'class', grade:'12', campus:'2', date:'2025-10-15'},
      {kind:'class', cert:'AP', campus:'1', date:'2025-10-17'},
      {kind:'revenue', grade:'9', campus:'1', date:'2025-10-03', amount: 3500000},
      {kind:'revenue', cert:'SAT', campus:'1', date:'2025-10-12', amount: 5200000},
      {kind:'revenue', grade:'12', campus:'2', date:'2025-10-15', amount: 7100000},
      {kind:'revenue', cert:'IGCSE', campus:'1', date:'2025-09-25', amount: 2400000}
    ];

    // Filters state
    const state = { mode:'grade', grade:'all', cert:'all', campus:'all', month:null };

    function toISO(d){ return d.toISOString().slice(0,10); }
    function monthStartEnd(yyyyMM){
      const [y,m] = yyyyMM.split('-').map(Number);
      const first = new Date(y, m-1, 1);
      const last  = new Date(y, m, 0);
      return { from: toISO(first), to: toISO(last) };
    }

    function applyAndRender(){
      const inCampus = (c) => state.campus === 'all' || c === state.campus;
      const inTrack = (row) => state.mode === 'grade'
        ? (state.grade==='all' ? !row.cert : row.grade===state.grade)
        : (state.cert==='all'  ? !!row.cert : row.cert===state.cert);
      const inMonth = (d) => {
        if (!state.month) return true;
        const {from,to} = monthStartEnd(state.month);
        return d >= from && d <= to;
      };

      const filtered = data.filter(r => inCampus(r.campus) && inMonth(r.date) && inTrack(r));

      const totalStudents = filtered.filter(r=>r.kind==='student').length;
      const totalTeachers = filtered.filter(r=>r.kind==='teacher').length;
      const totalClasses  = filtered.filter(r=>r.kind==='class').length;
      const totalRevenue  = filtered.filter(r=>r.kind==='revenue').reduce((s,r)=>s+(r.amount||0),0);

      $('#totalStudents').textContent = String(totalStudents);
      $('#totalTeachers').textContent = String(totalTeachers);
      $('#totalClasses').textContent  = String(totalClasses);
      $('#totalRevenue').textContent  = fmtMoney(totalRevenue);
    }

    function setMode(newMode){
      state.mode = newMode;
      $$('.seg').forEach(b=>{
        const active = b.dataset.mode === newMode;
        b.classList.toggle('active', active);
        b.setAttribute('aria-selected', active ? 'true' : 'false');
      });
      const gradeField = $('#fieldGrade');
      const certField  = $('#fieldCert');
      if(newMode === 'grade'){
        gradeField.hidden = false;  $('#gradeSelect').disabled = false;
        certField.hidden  = true;   $('#certSelect').disabled  = true; $('#certSelect').value='all'; state.cert='all';
      }else{
        gradeField.hidden = true;   $('#gradeSelect').disabled = true; $('#gradeSelect').value='all'; state.grade='all';
        certField.hidden  = false;  $('#certSelect').disabled  = false;
      }
      applyAndRender();
    }
    $$('.seg').forEach(b=> b.addEventListener('click', ()=> setMode(b.dataset.mode)));

    $('#gradeSelect').addEventListener('change', e=>{ state.grade = e.target.value; applyAndRender(); });
    $('#certSelect').addEventListener('change',  e=>{ state.cert  = e.target.value; applyAndRender(); });
    $('#campusSelect').addEventListener('change',e=>{ state.campus = e.target.value; applyAndRender(); });
    $('#monthPicker').addEventListener('change', e=>{ state.month = e.target.value || null; applyAndRender(); });

    $('#clearBtn').addEventListener('click', ()=>{
      setMode('grade');
      $('#gradeSelect').value = 'all'; state.grade='all';
      $('#certSelect').value  = 'all'; state.cert='all';
      $('#campusSelect').value = 'all'; state.campus='all';
      const now = new Date(), yyyy = now.getFullYear(), mm = String(now.getMonth()+1).padStart(2,'0');
      $('#monthPicker').value = `${yyyy}-${mm}`;
      state.month = `${yyyy}-${mm}`;
      applyAndRender();
    });

    function init(){
      const now = new Date(), yyyy = now.getFullYear(), mm = String(now.getMonth()+1).padStart(2,'0');
      $('#monthPicker').value = `${yyyy}-${mm}`;
      state.month = `${yyyy}-${mm}`;
      setMode('grade'); // gọi render
      lucide.createIcons();
    }
    document.addEventListener('DOMContentLoaded', init);
</script>
</body>
</html>
