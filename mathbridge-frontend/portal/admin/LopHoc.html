<!-- /LopHoc.html -->
<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>MathBridge Admin – Lớp Học</title>

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet"/>

    <!-- App stylesheet (tokens + layout) -->
    <link rel="stylesheet" href="css/admin.css" />
    <!-- Module stylesheet (classes management) -->
    <link rel="stylesheet" href="css/lophoc.css" />

    <!-- Lucide icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
</head>
<body>
<div class="app">
    <!-- ================== Header ================== -->
    <header class="app-header" role="banner">
        <div class="left">
            <button class="icon-btn" id="sidebarToggle" aria-label="Thu gọn/Mở rộng sidebar" title="Thu gọn/Mở rộng sidebar">
                <i data-lucide="panel-left-close" aria-hidden="true"></i>
            </button>

            <a class="brand" href="#" aria-label="MathBridge Admin">
                <i data-lucide="bridge" class="brand-icon" aria-hidden="true"></i>
                <span class="brand-text">MathBridge Admin</span>
            </a>
        </div>

        <div class="center">
            <!-- Giữ ô search tổng, nhưng module có search riêng trong toolbar -->
            <form class="search" role="search" aria-label="Tìm kiếm nhanh">
                <i data-lucide="search" aria-hidden="true"></i>
                <input id="globalSearch" type="search" placeholder="Tìm nhanh…" aria-label="Ô tìm kiếm" autocomplete="off"/>
            </form>
        </div>

        <div class="right">
            <div class="profile">
                <button class="profile-btn" id="profileBtn" aria-haspopup="true" aria-expanded="false">
                    <img class="avatar" src="https://i.pravatar.cc/40?img=13" alt="Avatar người dùng" />
                    <span class="hide-sm">Admin</span>
                    <i data-lucide="chevron-down" aria-hidden="true"></i>
                </button>
                <div class="menu" id="profileMenu" role="menu" aria-label="Menu hồ sơ">
                    <a href="#" role="menuitem"><i data-lucide="user"></i>Hồ sơ</a>
                    <a href="#" role="menuitem"><i data-lucide="settings"></i>Cài đặt</a>
                    <hr />
                    <a href="#" role="menuitem"><i data-lucide="log-out"></i>Đăng xuất</a>
                </div>
            </div>
        </div>
    </header>

    <!-- ================== Shell ================== -->
    <div class="shell">
        <!-- Sidebar -->
        <aside class="sidebar" id="sidebar" aria-label="Điều hướng chính">
            <nav class="nav">
                <a class="nav-item" href="index.html" data-key="dashboard" title="Dashboard">
                    <i data-lucide="layout-dashboard"></i><span>Dashboard</span>
                </a>
                <a class="nav-item" href="Teacher_admin.html" data-key="lecturers" title="Giảng Viên">
                    <i data-lucide="graduation-cap"></i><span>Giảng Viên</span>
                </a>
                <a class="nav-item active" href="LopHoc.html" data-key="classes" title="Lớp Học">
                    <i data-lucide="layers"></i><span>Lớp Học</span>
                </a>
                <a class="nav-item" href="#" data-key="contracts" title="Hợp đồng">
                    <i data-lucide="file-text"></i><span>Hợp đồng</span>
                </a>
                <a class="nav-item" href="#" data-key="revenue" title="Doanh thu">
                    <i data-lucide="badge-dollar-sign"></i><span>Doanh thu</span>
                </a>
                <a class="nav-item" href="#" data-key="curriculums" title="Chương Trình Học">
                    <i data-lucide="book-open-text"></i><span>Chương Trình Học</span>
                </a>

                <div class="nav-sep" role="separator" aria-hidden="true"></div>
                <a class="nav-item" href="#" data-key="students" title="Học viên">
                    <i data-lucide="users"></i><span>Học viên</span>
                </a>
                <a class="nav-item" href="#" data-key="parents" title="Phụ huynh">
                    <i data-lucide="contact"></i><span>Phụ huynh</span>
                </a>
                <a class="nav-item" href="#" data-key="campus" title="Cơ sở &amp; Phòng học">
                    <i data-lucide="building-2"></i><span>Cơ sở &amp; Phòng học</span>
                </a>
                <a class="nav-item" href="#" data-key="rbac" title="Quyền &amp; Tài khoản">
                    <i data-lucide="shield-check"></i><span>Quyền &amp; Tài khoản</span>
                </a>
                <a class="nav-item" href="#" data-key="settings" title="Cài đặt">
                    <i data-lucide="sliders-horizontal"></i><span>Cài đặt</span>
                </a>
                <a class="nav-item" href="#" data-key="audit" title="Lịch sử / Audit Logs">
                    <i data-lucide="clock-9"></i><span>Lịch sử / Audit Logs</span>
                </a>
            </nav>
        </aside>

        <!-- ================== Main ================== -->
        <main class="main" id="main" role="main">
            <!-- KHUNG TRẮNG BO TRÒN -->
            <section class="dash-card" aria-label="Classes content">
                <!-- ========== Section: Toolbar (lọc nhẹ) ========== -->
                <div class="filters toolbar filters-inline" aria-label="Lọc Lớp Học">
                    <div class="filters-row">
                        <!-- Search nhỏ trong module -->
                        <div class="form-field stretch">
                            <label for="classSearch">Tìm lớp học</label>
                            <div class="search search-sm" role="search">
                                <i data-lucide="search"></i>
                                <input id="classSearch" type="search" placeholder="Nhập tên lớp, mã lớp, giáo viên…" autocomplete="off" />
                            </div>
                        </div>

                        <!-- Trạng thái -->
                        <div class="form-field">
                            <label for="statusSelect">Trạng thái</label>
                            <select id="statusSelect">
                                <option value="all">Tất cả</option>
                                <option value="open">Chưa mở</option>
                                <option value="running">Đang học</option>
                                <option value="closed">Đã kết thúc</option>
                            </select>
                        </div>

                        <!-- Actions -->
                        <div class="filters-actions">
                            <button id="createClassBtn" class="btn brand">
                                <i data-lucide="plus"></i><span>Tạo lớp học</span>
                            </button>
                        </div>
                    </div>
                </div>

                <!-- ========== Section: Bảng lớp học ========== -->
                <article class="card content-panel">
                    <div class="card-head">
                        <h3>Quản lý Lớp Học</h3>
                    </div>

                    <div class="card-body content-body">
                        <!-- Table responsive wrapper -->
                        <div class="table-responsive" aria-label="Danh sách lớp học">
                            <table class="table" id="classesTable">
                                <thead>
                                <tr>
                                    <th>Lớp học</th>
                                    <th class="nowrap">Mã lớp</th>
                                    <th>Lịch học</th>
                                    <th>Hình thức</th>
                                    <th class="nowrap">Bắt đầu</th>
                                    <th class="nowrap">Học phí</th>
                                    <th>Trạng thái</th>
                                    <th>Đánh giá</th>
                                    <th class="nowrap">Hành động</th>
                                </tr>
                                </thead>
                                <tbody id="classesTbody">
                                <!-- rows render bằng JS -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </article>
            </section>
        </main>
    </div>
</div>

<!-- ========== Modal: Tạo lớp học ========== -->
<div class="modal" id="classModal" role="dialog" aria-modal="true" aria-labelledby="createClassTitle">
    <div class="modal-dialog card">
        <div class="modal-head">
            <h3 id="createClassTitle">Tạo lớp học</h3>
            <button class="icon-btn sm" id="closeModalBtn" aria-label="Đóng">
                <i data-lucide="x"></i>
            </button>
        </div>

        <form id="classForm" class="modal-body">
            <!-- Section: ID mapping (FK) -->
            <div class="form-grid">
                <div class="form-field">
                    <label for="id_lh">Mã lớp (ID_LH)</label>
                    <input id="id_lh" name="id_lh" type="text" required />
                </div>
                <div class="form-field">
                    <label for="id_nv">Giáo viên (ID_NV)</label>
                    <select id="id_nv" name="id_nv" required>
                        <option value="">-- Chọn --</option>
                        <option value="NV01">NV01 – Nguyễn A</option>
                        <option value="NV02">NV02 – Trần B</option>
                    </select>
                </div>
                <div class="form-field">
                    <label for="id_ct">Chương trình (ID_CT)</label>
                    <select id="id_ct" name="id_ct" required>
                        <option value="">-- Chọn --</option>
                        <option value="IGCSE">IGCSE</option>
                        <option value="A-Level">A-Level</option>
                        <option value="IB">IB</option>
                        <option value="AP">AP</option>
                        <option value="SAT">SAT</option>
                    </select>
                </div>
                <div class="form-field">
                    <label for="id_ch">Cơ sở/Phòng (ID_CH)</label>
                    <select id="id_ch" name="id_ch" required>
                        <option value="">-- Chọn --</option>
                        <option value="CS1-101">CS1-101</option>
                        <option value="CS2-203">CS2-203</option>
                    </select>
                </div>
            </div>

            <!-- Section: Thông tin lớp -->
            <div class="form-grid">
                <div class="form-field">
                    <label for="tenlop">Tên lớp</label>
                    <input id="tenlop" name="tenlop" type="text" placeholder="VD: IGCSE Math G10 – K1" required />
                </div>
                <div class="form-field">
                    <label for="ngayhoc">Ngày học (varchar)</label>
                    <input id="ngayhoc" name="ngayhoc" type="text" placeholder="Thứ 2,5 | 18:00–19:30" />
                </div>
                <div class="form-field">
                    <label for="loaingay">Loại ngày</label>
                    <input id="loaingay" name="loaingay" type="text" placeholder="weekday/weekend" />
                </div>
                <div class="form-field">
                    <label for="sobuoi">Số buổi</label>
                    <input id="sobuoi" name="sobuoi" type="number" min="1" step="1" />
                </div>
            </div>

            <div class="form-grid">
                <div class="form-field">
                    <label for="hinhthuc">Hình thức học</label>
                    <select id="hinhthuc" name="hinhthuc">
                        <option value="">-- Chọn --</option>
                        <option value="offline">Offline</option>
                        <option value="online">Online</option>
                        <option value="hybrid">Hybrid</option>
                    </select>
                </div>
                <div class="form-field">
                    <label for="batdau">Ngày bắt đầu</label>
                    <input id="batdau" name="batdau" type="date" />
                </div>
                <div class="form-field">
                    <label for="mucgia">Mức giá (VNĐ)</label>
                    <input id="mucgia" name="mucgia" type="number" min="0" step="1000" />
                </div>
                <div class="form-field">
                    <label for="trangthai">Trạng thái</label>
                    <select id="trangthai" name="trangthai">
                        <option value="open">Chưa mở</option>
                        <option value="running">Đang học</option>
                        <option value="closed">Đã kết thúc</option>
                    </select>
                </div>
            </div>

            <div class="form-grid onecol">
                <div class="form-field">
                    <label for="danhgia">Đánh giá</label>
                    <input id="danhgia" name="danhgia" type="text" placeholder="Nhận xét ngắn (tối đa 200 ký tự)" maxlength="200"/>
                </div>
                <div class="form-field">
                    <label for="mota">Mô tả</label>
                    <textarea id="mota" name="mota" rows="3" maxlength="200" placeholder="Ghi chú cho lớp học…"></textarea>
                </div>
            </div>

            <div class="modal-actions">
                <button type="button" class="btn ghost" id="cancelModalBtn">
                    <i data-lucide="x-circle"></i><span>Huỷ</span>
                </button>
                <button type="submit" class="btn brand">
                    <i data-lucide="save"></i><span>Lưu lớp học</span>
                </button>
            </div>
        </form>
    </div>
</div>

<!-- ========== JS ========== -->
<script>
    /* ---------- Helpers ---------- */
    const $ = (s, c=document)=>c.querySelector(s);
    const $$ = (s, c=document)=>Array.from(c.querySelectorAll(s));
    const fmtMoney = n => (n||0).toLocaleString('vi-VN') + ' ₫';
    const badge = (status)=>{
      if(status==='running') return '<span class="badge running">Đang học</span>';
      if(status==='closed')  return '<span class="badge closed">Đã kết thúc</span>';
      return '<span class="badge open">Chưa mở</span>';
    };

    /* ---------- Chrome/UI actions copied from index ---------- */
    $('#sidebarToggle').addEventListener('click', ()=> document.body.classList.toggle('sidebar-collapsed'));
    $('#profileBtn').addEventListener('click', ()=> $('#profileMenu').classList.toggle('open'));
    document.addEventListener('click', (e)=>{ if(!e.target.closest('.profile')) $('#profileMenu').classList.remove('open'); });

    /* ---------- Mock data của bảng LopHoc (theo ảnh cột) ---------- */
    const classes = [
      {
        ID_LH:'LH001', ID_NV:'NV01', ID_CT:'IGCSE', ID_CH:'CS1-101',
        TenLop:'IGCSE Math G10 – K1', NgayHoc:'T2, T5 (18:00–19:30)', LoaiNgay:'weekday', SoBuoi:24,
        HinhThucHoc:'offline', NgayBatDau:'2025-10-20', MucGia: 1800000, DanhGia:'Ổn định',
        TrangThai:'running', MoTa:'Lớp nền tảng, sĩ số 12'
      },
      {
        ID_LH:'LH002', ID_NV:'NV02', ID_CT:'SAT', ID_CH:'CS2-203',
        TenLop:'SAT Math – Intensive', NgayHoc:'T7, CN (8:30–10:30)', LoaiNgay:'weekend', SoBuoi:16,
        HinhThucHoc:'hybrid', NgayBatDau:'2025-11-05', MucGia: 2500000, DanhGia:'Nên đẩy bài tập',
        TrangThai:'open', MoTa:'Chuẩn bị 6 tuần trước kỳ thi'
      },
      {
        ID_LH:'LH003', ID_NV:'NV01', ID_CT:'A-Level', ID_CH:'CS1-101',
        TenLop:'A-Level Pure Math', NgayHoc:'T3 (19:00–21:00)', LoaiNgay:'weekday', SoBuoi:20,
        HinhThucHoc:'online', NgayBatDau:'2025-08-10', MucGia: 2200000, DanhGia:'Đã hoàn tất',
        TrangThai:'closed', MoTa:'Khoá đã kết thúc'
      }
    ];

    /* ---------- Render table ---------- */
    function renderTable(){
      const q = ($('#classSearch').value || '').toLowerCase().trim();
      const st = $('#statusSelect').value;
      const filtered = classes.filter(c=>{
        const okStatus = (st==='all') || (c.TrangThai===st);
        const text = [c.TenLop,c.ID_LH,c.ID_NV,c.ID_CT,c.ID_CH].join(' ').toLowerCase();
        const okSearch = !q || text.includes(q);
        return okStatus && okSearch;
      });

      const rows = filtered.map(c=>`
        <tr>
          <td>
            <div class="tenlop">${c.TenLop}</div>
            <div class="meta">GV: ${c.ID_NV} • CT: ${c.ID_CT} • Phòng: ${c.ID_CH}</div>
          </td>
          <td class="nowrap">${c.ID_LH}</td>
          <td>
            <div>${c.NgayHoc}</div>
            <div class="meta">${c.LoaiNgay} • ${c.SoBuoi} buổi</div>
          </td>
          <td class="nowrap">${c.HinhThucHoc}</td>
          <td class="nowrap">${c.NgayBatDau}</td>
          <td class="nowrap price">${fmtMoney(c.MucGia)}</td>
          <td>${badge(c.TrangThai)}</td>
          <td>${c.DanhGia || ''}</td>
          <td class="td-actions">
            <div class="row-actions">
              <button class="icon-btn sm" title="Xem"><i data-lucide="eye"></i></button>
              <button class="icon-btn sm" title="Sửa"><i data-lucide="pencil"></i></button>
              <button class="icon-btn sm" title="Xoá"><i data-lucide="trash-2"></i></button>
            </div>
          </td>
        </tr>
      `).join('');

      $('#classesTbody').innerHTML = rows || `
        <tr><td colspan="9">
          <div class="empty-lg">
            <i data-lucide="layout-grid"></i>
            <p>Không tìm thấy lớp phù hợp.</p>
          </div>
        </td></tr>`;

      lucide.createIcons(); // refresh icons after render
    }

    /* ---------- Modal create class ---------- */
    const modal = $('#classModal');
    function openModal(){ modal.style.display='flex'; document.body.style.overflow='hidden'; }
    function closeModal(){ modal.style.display='none'; document.body.style.overflow=''; }

    $('#createClassBtn').addEventListener('click', openModal);
    $('#closeModalBtn').addEventListener('click', closeModal);
    $('#cancelModalBtn').addEventListener('click', closeModal);

    $('#classForm').addEventListener('submit', (e)=>{
      e.preventDefault();
      const f = new FormData(e.target);
      // push tạm vào mock (thay cho API)
      classes.unshift({
        ID_LH: f.get('id_lh'), ID_NV:f.get('id_nv')||'—', ID_CT:f.get('id_ct')||'—', ID_CH:f.get('id_ch')||'—',
        TenLop:f.get('tenlop')||'', NgayHoc:f.get('ngayhoc')||'', LoaiNgay:f.get('loaingay')||'', SoBuoi: Number(f.get('sobuoi')||0),
        HinhThucHoc:f.get('hinhthuc')||'', NgayBatDau:f.get('batdau')||'', MucGia: Number(f.get('mucgia')||0),
        DanhGia:f.get('danhgia')||'', TrangThai:f.get('trangthai')||'open', MoTa:f.get('mota')||''
      });
      closeModal();
      e.target.reset();
      renderTable();
    });

    /* ---------- Filters ---------- */
    $('#classSearch').addEventListener('input', renderTable);
    $('#statusSelect').addEventListener('change', renderTable);

    /* ---------- Init ---------- */
    function init(){
      renderTable();
      lucide.createIcons();
    }
    document.addEventListener('DOMContentLoaded', init);
</script>
</body>
</html>
