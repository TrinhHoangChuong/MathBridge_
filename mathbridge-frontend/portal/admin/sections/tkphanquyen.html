<!-- ICONS (Remix Icon) -->
<link
        rel="stylesheet"
        href="https://cdn.jsdelivr.net/npm/remixicon@3.5.0/fonts/remixicon.css"
/>

<div class="dash-card content-panel tkpq-panel" id="tkphanquyen-panel">
    <!-- HEADER -->
    <div class="tkpq-header">
        <div class="tkpq-header-left">
            <div class="tkpq-header-icon">
                <i class="ri-user-settings-line"></i>
            </div>
            <div>
                <h2 class="tkpq-title">Tài khoản &amp; Phân quyền</h2>
                <p class="tkpq-subtitle">
                    Quản lý tài khoản đăng nhập và phân quyền dựa trên bảng TaiKhoan, Role,
                    TaiKhoan_VaiTro.
                </p>
            </div>
        </div>

        <div class="tkpq-header-right">
            <button class="btn ghost" id="tkpq-refresh-all" type="button">
                <i class="ri-refresh-line"></i>
                <span>Làm mới dữ liệu</span>
            </button>
        </div>
    </div>

    <!-- TABS -->
    <div class="tkpq-tabs">
        <button class="tkpq-tab active" data-view="accounts" type="button">
            <i class="ri-user-line"></i>
            <span>Tài khoản</span>
        </button>
        <button class="tkpq-tab" data-view="roles" type="button">
            <i class="ri-shield-keyhole-line"></i>
            <span>Vai trò</span>
        </button>
    </div>

    <!-- VIEWS WRAPPER -->
    <div class="tkpq-views">
        <!-- ===== VIEW: ACCOUNTS ===== -->
        <div class="tkpq-view" data-view="accounts">
            <div class="section-head">
                <div>
                    <div class="section-title">Quản lý tài khoản</div>
                    <div class="section-sub">
                        Danh sách tài khoản từ bảng TaiKhoan, cho phép tạo tài khoản mới, gán vai trò (Role)
                        và bật / tắt trạng thái hoạt động. Không xóa tài khoản, chỉ khóa hoặc mở lại.
                    </div>
                </div>
            </div>

            <!-- LAYOUT 2 CỘT: TRÁI = DANH SÁCH, PHẢI = CHI TIẾT -->
            <div class="tkpq-accounts-layout">
                <!-- CỘT TRÁI: FILTER + TABLE -->
                <div class="tkpq-column tkpq-column-main">
                    <div class="section-card">
                        <!-- FILTERS -->
                        <div class="tkpq-filters">
                            <div class="tkpq-filter-row">
                                <div class="tkpq-filter-group tkpq-filter-search">
                                    <label class="tkpq-filter-label" for="tkpq-filter-search">
                                        Từ khóa
                                    </label>
                                    <div class="tkpq-input-with-icon">
                                        <i class="ri-search-line"></i>
                                        <input
                                                id="tkpq-filter-search"
                                                type="text"
                                                class="input-text"
                                                placeholder="Tìm theo ID_TK, email..."
                                        />
                                    </div>
                                </div>

                                <div class="tkpq-filter-group">
                                    <label class="tkpq-filter-label" for="tkpq-filter-owner-type">
                                        Loại tài khoản
                                    </label>
                                    <select id="tkpq-filter-owner-type" class="input-select">
                                        <option value="ALL">Tất cả</option>
                                        <option value="HS">Học sinh</option>
                                        <option value="NV">Nhân viên</option>
                                        <option value="OTHER">Khác</option>
                                    </select>
                                </div>
                            </div>

                            <div class="tkpq-filter-row">
                                <div class="tkpq-filter-group">
                                    <label class="tkpq-filter-label" for="tkpq-filter-role">
                                        Vai trò
                                    </label>
                                    <select id="tkpq-filter-role" class="input-select">
                                        <option value="">Tất cả vai trò</option>
                                        <!-- fill bằng JS từ bảng Role -->
                                    </select>
                                </div>

                                <div class="tkpq-filter-group">
                                    <label class="tkpq-filter-label" for="tkpq-filter-status">
                                        Trạng thái
                                    </label>
                                    <select id="tkpq-filter-status" class="input-select">
                                        <option value="ALL">Tất cả</option>
                                        <option value="ACTIVE">Đang hoạt động</option>
                                        <option value="INACTIVE">Ngừng hoạt động</option>
                                        <option value="LOCKED">Đã khóa</option>
                                    </select>
                                </div>

                                <div class="tkpq-filter-group tkpq-filter-actions">
                                    <button class="btn ghost" id="tkpq-filter-reset" type="button">
                                        <i class="ri-restart-line"></i>
                                        <span>Xóa bộ lọc</span>
                                    </button>
                                    <button class="btn primary" id="tkpq-btn-add-account" type="button">
                                        <i class="ri-user-add-line"></i>
                                        <span>Thêm tài khoản</span>
                                    </button>
                                </div>
                            </div>
                        </div>

                        <!-- TABLE WRAPPER -->
                        <div class="tkpq-table-wrapper">
                            <table class="tkpq-table">
                                <thead>
                                <tr>
                                    <th>ID_TK</th>
                                    <th>Email</th>
                                    <th>Loại</th>
                                    <th>Chủ sở hữu</th>
                                    <th>Vai trò</th>
                                    <th>Trạng thái</th>
                                    <th>Thời điểm tạo</th>
                                    <th class="tkpq-col-actions">Hành động</th>
                                </tr>
                                </thead>
                                <tbody id="tkpq-accounts-tbody">
                                <!-- render bằng JS -->
                                </tbody>
                            </table>

                            <div class="tkpq-empty-state" id="tkpq-accounts-empty" hidden>
                                <i class="ri-database-2-line"></i>
                                <p>Không tìm thấy tài khoản nào.</p>
                            </div>
                        </div>

                        <!-- PAGINATION -->
                        <div class="tkpq-pagination" id="tkpq-accounts-pagination"></div>
                    </div>
                </div>

                <!-- CỘT PHẢI: CHI TIẾT TÀI KHOẢN & VAI TRÒ -->
                <div class="tkpq-column tkpq-column-side">
                    <!-- THÔNG TIN TÀI KHOẢN -->
                    <div class="section-card">
                        <div class="section-head compact">
                            <div>
                                <div class="section-title small">Thông tin tài khoản</div>
                                <div class="section-sub">
                                    Email, loại, chủ sở hữu &amp; trạng thái hoạt động.
                                </div>
                            </div>
                            <span class="pill" id="tkpq-account-selected-pill">
                                Chưa chọn tài khoản
                            </span>
                        </div>
                        <div class="tkpq-account-info" id="tkpq-account-detail-panel">
                            <p class="muted">Chọn một tài khoản ở bảng bên trái để xem chi tiết.</p>
                        </div>
                    </div>

                    <!-- VAI TRÒ & PHÂN QUYỀN -->
                    <div class="section-card">
                        <div class="section-head compact">
                            <div>
                                <div class="section-title small">Vai trò &amp; phân quyền</div>
                                <div class="section-sub">
                                    Danh sách Role được gán cho tài khoản (từ bảng Role, TaiKhoan_VaiTro).
                                </div>
                            </div>
                        </div>
                        <div class="tkpq-account-roles" id="tkpq-account-roles-panel">
                            <p class="muted">Chưa có dữ liệu vai trò. Chọn một tài khoản để xem.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ===== VIEW: ROLES ===== -->
        <div class="tkpq-view" data-view="roles" hidden>
            <div class="section-head">
                <div>
                    <div class="section-title">Quản lý vai trò</div>
                    <div class="section-sub">
                        Quản lý danh sách Role và mô tả, dùng để gán quyền cho tài khoản.
                    </div>
                </div>

                <div class="section-head-actions">
                    <button class="btn primary" id="tkpq-btn-add-role" type="button">
                        <i class="ri-shield-star-line"></i>
                        <span>Thêm vai trò</span>
                    </button>
                </div>
            </div>

            <div class="tkpq-roles-layout">
                <!-- CỘT TRÁI: DANH SÁCH ROLE -->
                <div class="tkpq-column tkpq-column-main">
                    <div class="section-card">
                        <div class="tkpq-filters">
                            <div class="tkpq-filter-row">
                                <div class="tkpq-filter-group tkpq-filter-search">
                                    <label class="tkpq-filter-label" for="tkpq-role-search">
                                        Từ khóa
                                    </label>
                                    <div class="tkpq-input-with-icon">
                                        <i class="ri-search-line"></i>
                                        <input
                                                id="tkpq-role-search"
                                                type="text"
                                                class="input-text"
                                                placeholder="Tìm ID_Role, tên vai trò..."
                                        />
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="tkpq-table-wrapper">
                            <table class="tkpq-table">
                                <thead>
                                <tr>
                                    <th>ID_Role</th>
                                    <th>Tên vai trò</th>
                                    <th>Ghi chú</th>
                                    <th class="tkpq-col-actions">Hành động</th>
                                </tr>
                                </thead>
                                <tbody id="tkpq-roles-tbody">
                                <!-- render bằng JS -->
                                </tbody>
                            </table>

                            <div class="tkpq-empty-state" id="tkpq-roles-empty" hidden>
                                <i class="ri-database-2-line"></i>
                                <p>Không tìm thấy vai trò nào.</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- CỘT PHẢI: CHI TIẾT ROLE -->
                <div class="tkpq-column tkpq-column-side">
                    <div class="section-card">
                        <div class="section-head compact">
                            <div>
                                <div class="section-title small">Chi tiết vai trò</div>
                                <div class="section-sub">
                                    Mô tả và thống kê nhanh (tùy chọn triển khai sau).
                                </div>
                            </div>
                        </div>
                        <div class="tkpq-role-detail" id="tkpq-role-detail-panel">
                            <p class="muted">Chọn một vai trò ở bảng bên trái để xem chi tiết.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- MODAL: ACCOUNT -->
    <div class="modal-backdrop" id="tkpq-account-modal" hidden>
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title" id="tkpq-account-modal-title">
                    Thêm tài khoản
                </h3>
                <button
                        type="button"
                        class="btn ghost icon-only"
                        data-close-modal="tkpq-account-modal"
                >
                    <i class="ri-close-line"></i>
                </button>
            </div>

            <form id="tkpq-account-form" class="modal-body">
                <input type="hidden" id="tkpq-account-idTk" />

                <div class="modal-grid">
                    <div class="modal-field">
                        <label for="tkpq-account-email">Email</label>
                        <input
                                id="tkpq-account-email"
                                type="email"
                                class="input-text"
                                required
                        />
                    </div>

                    <div class="modal-field">
                        <label for="tkpq-account-password">
                            Mật khẩu
                            <span class="field-hint">
                                (Để trống khi sửa nếu không muốn đổi)
                            </span>
                        </label>
                        <input
                                id="tkpq-account-password"
                                type="password"
                                class="input-text"
                                minlength="6"
                        />
                    </div>

                    <div class="modal-field">
                        <label for="tkpq-account-status">Trạng thái</label>
                        <select id="tkpq-account-status" class="input-select">
                            <option value="ACTIVE">Đang hoạt động</option>
                            <option value="INACTIVE">Ngừng hoạt động</option>
                            <option value="LOCKED">Đã khóa</option>
                        </select>
                    </div>

                    <div class="modal-field">
                        <label>Loại &amp; chủ sở hữu</label>
                        <div class="tkpq-owner-info">
                            <div>
                                <span class="tkpq-owner-label">ID_HS:</span>
                                <span id="tkpq-account-idHs">-</span>
                            </div>
                            <div>
                                <span class="tkpq-owner-label">ID_NV:</span>
                                <span id="tkpq-account-idNv">-</span>
                            </div>
                            <p class="tkpq-owner-note">
                                Mapping Học sinh/Nhân viên được cập nhật ở các module tương ứng
                                (Học sinh &amp; Học tập, Nhân sự &amp; Hợp đồng). Trang này chỉ
                                quản lý đăng nhập &amp; phân quyền.
                            </p>
                        </div>
                    </div>

                    <div class="modal-field modal-field-full">
                        <label for="tkpq-account-roles">
                            Vai trò (Role)
                            <span class="field-hint">
                                Lấy từ bảng Role, lưu vào bảng TaiKhoan_VaiTro.
                            </span>
                        </label>
                        <select
                                id="tkpq-account-roles"
                                class="input-select"
                                multiple
                        >
                            <!-- fill bằng JS từ Role -->
                        </select>
                    </div>
                </div>

                <div class="modal-footer">
                    <button
                            type="button"
                            class="btn ghost"
                            data-close-modal="tkpq-account-modal"
                    >
                        Hủy
                    </button>
                    <button type="submit" class="btn primary">
                        <i class="ri-save-3-line"></i>
                        <span>Lưu</span>
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- MODAL: ROLE -->
    <div class="modal-backdrop" id="tkpq-role-modal" hidden>
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title" id="tkpq-role-modal-title">
                    Thêm vai trò
                </h3>
                <button
                        type="button"
                        class="btn ghost icon-only"
                        data-close-modal="tkpq-role-modal"
                >
                    <i class="ri-close-line"></i>
                </button>
            </div>

            <form id="tkpq-role-form" class="modal-body">
                <input type="hidden" id="tkpq-role-mode" value="create" />

                <div class="modal-grid">
                    <div class="modal-field">
                        <label for="tkpq-role-id">ID_Role</label>
                        <input
                                id="tkpq-role-id"
                                type="text"
                                class="input-text"
                                maxlength="10"
                                required
                        />
                    </div>

                    <div class="modal-field">
                        <label for="tkpq-role-name">Tên vai trò</label>
                        <input
                                id="tkpq-role-name"
                                type="text"
                                class="input-text"
                                maxlength="100"
                                required
                        />
                    </div>

                    <div class="modal-field modal-field-full">
                        <label for="tkpq-role-note">Ghi chú</label>
                        <textarea
                                id="tkpq-role-note"
                                rows="3"
                                class="input-text"
                        ></textarea>
                    </div>
                </div>

                <div class="modal-footer">
                    <button
                            type="button"
                            class="btn ghost"
                            data-close-modal="tkpq-role-modal"
                    >
                        Hủy
                    </button>
                    <button type="submit" class="btn primary">
                        <i class="ri-save-3-line"></i>
                        <span>Lưu</span>
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>
