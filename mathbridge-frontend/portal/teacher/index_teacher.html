<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teacher Dashboard - MathBridge</title>
    <link rel="stylesheet" href="../assets/css/teacher-dashboard.css">
    <style>
        /* Fallback styles nếu file CSS chính không tải được */
        .sidebar { background: #1e293b; color: white; }
        .content-section { display: none; }
        .content-section.active { display: block; }
        .nav-item { cursor: pointer; }
        .btn { cursor: pointer; }

        /* Lightweight styles cho danh sách học sinh trong modal khi thiếu CSS */
        .students-summary {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 12px;
            margin-bottom: 16px;
        }
        .students-summary .summary-item {
            background: #f1f5f9;
            border-radius: 12px;
            padding: 12px;
            text-align: center;
        }
        .students-summary .summary-number {
            display: block;
            font-size: 20px;
            font-weight: 700;
            color: #0f172a;
        }
        .students-summary .summary-label {
            font-size: 13px;
            color: #64748b;
        }
        .students-card-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(260px, 1fr));
            gap: 16px;
        }
        .student-card {
            background: #fff;
            border-radius: 16px;
            box-shadow: 0 12px 32px rgba(15, 23, 42, 0.08);
            display: flex;
            flex-direction: column;
            padding: 16px;
        }
        .student-card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
            font-size: 12px;
            text-transform: uppercase;
            color: #94a3b8;
        }
        .student-card-body {
            display: flex;
            align-items: center;
            gap: 16px;
        }
        .student-avatar.large {
            width: 56px;
            height: 56px;
            border-radius: 50%;
            background: #ef4444;
            color: #fff;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 18px;
            text-transform: uppercase;
        }
        .student-card-info {
            flex: 1;
        }
        .student-card-info .student-name {
            font-size: 16px;
            font-weight: 600;
            color: #0f172a;
            margin-bottom: 4px;
        }
        .student-card-info .student-meta {
            font-size: 13px;
            color: #475569;
            margin-bottom: 4px;
            display: flex;
            align-items: center;
            gap: 6px;
        }
        .student-card-footer {
            margin-top: 16px;
            display: flex;
            gap: 8px;
            justify-content: flex-end;
        }
        .student-card-footer .btn {
            flex: 1;
            display: flex;
            justify-content: center;
            gap: 6px;
        }
        .student-order {
            font-weight: 600;
            letter-spacing: 0.08em;
        }
        .grade-class-filters {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 12px;
            margin-bottom: 20px;
        }
        .class-filter-chip {
            border: 1px solid #e2e8f0;
            border-radius: 14px;
            padding: 12px 16px;
            background: #ffffff;
            display: flex;
            flex-direction: column;
            gap: 6px;
            transition: all 0.2s ease;
        }
        .class-filter-chip strong {
            font-size: 14px;
            color: #0f172a;
        }
        .class-filter-chip span {
            font-size: 12px;
            color: #64748b;
        }
        .class-filter-chip.active {
            border-color: #ef4444;
            box-shadow: 0 8px 20px rgba(239, 68, 68, 0.18);
        }
        .grade-stats-grid .grade-stat-card h3 {
            font-size: 24px;
            margin: 0;
        }
        .grade-stats-grid .grade-stat-card p {
            margin: 0;
            font-size: 13px;
            color: #64748b;
        }
        .grade-distribution-bars {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
            gap: 12px;
            padding: 16px;
            background: #fff;
            border-radius: 16px;
            box-shadow: inset 0 0 0 1px #e2e8f0;
        }
        .grade-distribution-bar {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 6px;
        }
        .grade-distribution-bar .bar-track {
            width: 100%;
            height: 120px;
            border-radius: 12px;
            background: #f1f5f9;
            display: flex;
            align-items: flex-end;
            overflow: hidden;
        }
        .grade-distribution-bar .bar-fill {
            width: 100%;
            border-radius: 12px;
            background: linear-gradient(180deg, #ef4444, #be123c);
        }
        .grade-distribution-bar .bar-label {
            font-size: 12px;
            color: #64748b;
        }
        .grade-distribution-bar .bar-value {
            font-size: 14px;
            font-weight: 600;
            color: #0f172a;
        }
        .assignment-reference {
            margin-top: 12px;
        }
        .assignment-reference .assignment-ref-link {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            color: #ef4444;
            font-weight: 600;
            text-decoration: none;
        }
        .assignment-reference .assignment-ref-link i {
            font-size: 14px;
        }
        .assignment-reference .assignment-ref-text {
            display: flex;
            gap: 8px;
            align-items: flex-start;
            background: #f8fafc;
            border-radius: 12px;
            padding: 10px 12px;
            color: #1e293b;
            font-size: 13px;
            line-height: 1.5;
        }
    </style>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <!-- Sidebar -->
    <div class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <div class="logo">
                <i class="fas fa-graduation-cap"></i>
                <span>MathBridge</span>
            </div>
            <button class="sidebar-toggle" id="sidebarToggle">
                <i class="fas fa-angle-left"></i>
            </button>
        </div>
        
        <nav class="sidebar-nav">
            <ul>
                <li class="nav-item active" data-section="dashboard">
                    <a href="#dashboard">
                        <i class="fas fa-tachometer-alt"></i>
                        <span>Dashboard</span>
                    </a>
                </li>
                <li class="nav-item" data-section="classes">
                    <a href="#classes">
                        <i class="fas fa-chalkboard-teacher"></i>
                        <span>Lớp học</span>
                    </a>
                </li>
                <li class="nav-item" data-section="assignments">
                    <a href="#assignments">
                        <i class="fas fa-tasks"></i>
                        <span>Bài tập</span>
                    </a>
                </li>
                <li class="nav-item" data-section="grades">
                    <a href="#grades">
                        <i class="fas fa-chart-line"></i>
                        <span>Điểm số</span>
                    </a>
                </li>
                <li class="nav-item" data-section="schedule">
                    <a href="#schedule">
                        <i class="fas fa-calendar-alt"></i>
                        <span>Lịch dạy</span>
                    </a>
                </li>
                <li class="nav-item" data-section="messages">
                    <a href="#messages">
                        <i class="fas fa-envelope"></i>
                        <span>Tin nhắn</span>
                    </a>
                </li>
            </ul>
        </nav>
        
    </div>

    <!-- Main Content -->
    <div class="main-content" id="mainContent">
        <!-- Header -->
        <header class="header">
            <div class="header-left">
                <button class="mobile-menu-toggle" id="mobileMenuToggle">
                    <i class="fas fa-bars"></i>
                </button>
                <h1 class="page-title" id="pageTitle">Dashboard</h1>
                <div class="current-time">
                    <span id="currentDate"></span>
                    <span id="currentTime"></span>
                </div>
            </div>
            <div class="header-right">
                <div class="notifications">
                    <button class="notification-btn" id="notificationBtn">
                        <i class="fas fa-bell"></i>
                        <span class="notification-badge">3</span>
                    </button>
                </div>
                <div class="user-menu">
                    <button class="user-menu-btn" id="userMenuBtn" type="button">
                        <div class="user-avatar-small" id="headerAvatar">
                            <i class="fas fa-user"></i>
                        </div>
                        <span id="headerDisplayName">Giáo viên</span>
                        <i class="fas fa-chevron-down"></i>
                    </button>
                    <div class="user-dropdown" id="userDropdown">
                        <div class="dropdown-header">
                            <span class="dropdown-name" id="dropdownName">Giáo viên MathBridge</span>
                            <span class="dropdown-email" id="dropdownEmail">teacher@mathbridge.vn</span>
                        </div>
                        <div class="actions">
                            <button type="button" id="openProfileModal">
                                <i class="fas fa-user-edit"></i>
                                Cập nhật thông tin cá nhân
                            </button>
                            <button type="button" id="viewProfileBtn">
                                <i class="fas fa-id-card-alt"></i>
                                Xem hồ sơ chi tiết
                            </button>
                            <button type="button" class="danger" id="logoutMenuBtn">
                                <i class="fas fa-sign-out-alt"></i>
                                Đăng xuất
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </header>

        <!-- Content Sections -->
        <main class="content">
            <!-- Dashboard Section -->
            <section class="content-section active" id="dashboard">
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-chalkboard-teacher"></i>
                        </div>
                        <div class="stat-content">
                            <h3>5</h3>
                            <p>Lớp học</p>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-users"></i>
                        </div>
                        <div class="stat-content">
                            <h3>120</h3>
                            <p>Học sinh</p>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-tasks"></i>
                        </div>
                        <div class="stat-content">
                            <h3>15</h3>
                            <p>Bài tập chưa chấm</p>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-calendar-check"></i>
                        </div>
                        <div class="stat-content">
                            <h3>3</h3>
                            <p>Lịch dạy hôm nay</p>
                        </div>
                    </div>
                </div>

                <div class="dashboard-grid">
                    <div class="dashboard-card">
                        <div class="card-header">
                            <h3>Lớp học gần đây</h3>
                            <button class="btn btn-primary btn-sm">Xem tất cả</button>
                        </div>
                        <div class="card-content">
                            <div class="class-list">
                                <div class="empty-state">
                                    <p>Đang tải lớp học gần đây...</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="dashboard-card">
                        <div class="card-header">
                            <h3>Bài tập cần chấm</h3>
                            <button class="btn btn-primary btn-sm">Chấm ngay</button>
                        </div>
                        <div class="card-content">
                            <div class="assignment-list">
                                <div class="empty-state">
                                    <p>Đang tải bài tập cần chấm...</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Classes Section -->
            <section class="content-section" id="classes">
                <div class="section-header">
                    <h2>Quản lý lớp học</h2>
                    <div class="header-actions">
                        <button class="btn btn-primary" onclick="openSuggestClassModal()">
                            <i class="fas fa-plus"></i>
                            Đề xuất lớp học
                        </button>
                        <!-- <button class="btn btn-success" onclick="manageClassStudents()">
                            <i class="fas fa-users"></i>
                            Quản lý học sinh
                        </button> -->
                    </div>
                </div>
                
                <div class="classes-grid">
                    <div class="empty-state">
                        <p>Đang tải danh sách lớp học...</p>
                    </div>
                </div>
            </section>


            <!-- Assignments Section -->
            <section class="content-section" id="assignments">
                <div class="section-header">
                    <h2>Quản lý bài tập</h2>
                    <div class="header-actions">
                        <button class="btn btn-primary" onclick="createAssignment()">
                            <i class="fas fa-plus"></i>
                            Tạo bài tập mới
                        </button>
                    </div>
                </div>
                
                <div class="assignments-grid">
                    <div class="empty-state">
                        <p>Đang tải danh sách bài tập...</p>
                    </div>
                </div>
            </section>

            <!-- Grades Section -->
            <section class="content-section" id="grades">
                <div class="section-header">
                    <h2>Quản lý điểm số</h2>
                    <div class="header-actions">
                        <select class="form-select" id="classFilter" onchange="filterGradesByClass(this.value)">
                            <option value="">Tất cả lớp</option>
                        </select>
                        <button class="btn btn-primary" onclick="exportGrades()">
                            <i class="fas fa-download"></i>
                            Xuất báo cáo
                        </button>
                    </div>
                </div>

                <div class="grade-class-filters" id="gradeClassFilters">
                    <div class="empty-state">
                        <p>Đang tải danh sách lớp...</p>
                    </div>
                </div>

                <!-- Grade Statistics -->
                <div class="grade-stats-grid">
                    <div class="grade-stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-chart-line"></i>
                        </div>
                        <div class="stat-content">
                            <h3 id="gradeAverageValue">--</h3>
                            <p>Điểm trung bình</p>
                        </div>
                    </div>
                    <div class="grade-stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-users"></i>
                        </div>
                        <div class="stat-content">
                            <h3 id="gradeStudentCount">--</h3>
                            <p>Số học sinh</p>
                        </div>
                    </div>
                    <div class="grade-stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-trophy"></i>
                        </div>
                        <div class="stat-content">
                            <h3 id="gradeExcellentCount">--</h3>
                            <p>Học sinh giỏi</p>
                        </div>
                    </div>
                    <div class="grade-stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-exclamation-triangle"></i>
                        </div>
                        <div class="stat-content">
                            <h3 id="gradeNeedsSupportCount">--</h3>
                            <p>Cần hỗ trợ</p>
                        </div>
                    </div>
                </div>

                <!-- Grade Table -->
                <div class="grades-table-container">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                        <h3 style="margin: 0;">Chi tiết điểm số</h3>
                        <button type="button" class="btn btn-primary" id="editGradesBtn" onclick="toggleEditMode(event)">
                            <i class="fas fa-edit"></i> Chỉnh sửa
                        </button>
                    </div>
                    <div class="table-wrapper">
                        <table class="grades-table">
                            <thead>
                                <tr>
                                    <th>Học sinh</th>
                                    <th>Lớp</th>
                                    <th>Điểm KT 15'</th>
                                    <th>Điểm KT 1 tiết</th>
                                    <th>Điểm thi HK</th>
                                    <th>Điểm TB</th>
                                    <th>Xếp loại</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr class="placeholder-row">
                                    <td colspan="7" class="text-center">Vui lòng chọn lớp để xem điểm số.</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>

            <!-- Schedule Section -->
            <section class="content-section" id="schedule">
                <div class="section-header">
                    <h2>Lịch dạy</h2>
                    <div class="header-actions">
                        <button class="btn btn-secondary" onclick="exportSchedule()">
                            <i class="fas fa-download"></i>
                            Xuất lịch
                        </button>
                        <button class="btn btn-primary" onclick="addSchedule()">
                            <i class="fas fa-plus"></i>
                            Thêm lịch dạy
                        </button>
                    </div>
                </div>
                
                <div class="schedule-calendar">
                    <div class="calendar-header">
                        <button class="btn-icon" id="prevMonth" onclick="changeMonth(-1)">
                            <i class="fas fa-chevron-left"></i>
                        </button>
                        <h3 id="currentMonth">Tháng 12, 2024</h3>
                        <button class="btn-icon" id="nextMonth" onclick="changeMonth(1)">
                            <i class="fas fa-chevron-right"></i>
                        </button>
                    </div>
                    <div class="calendar-grid" id="calendarGrid">
                        <!-- Calendar headers -->
                        <div class="calendar-day-header">CN</div>
                        <div class="calendar-day-header">T2</div>
                        <div class="calendar-day-header">T3</div>
                        <div class="calendar-day-header">T4</div>
                        <div class="calendar-day-header">T5</div>
                        <div class="calendar-day-header">T6</div>
                        <div class="calendar-day-header">T7</div>
                        
                        <!-- Calendar days -->
                        <div class="calendar-day other-month">25</div>
                        <div class="calendar-day other-month">26</div>
                        <div class="calendar-day other-month">27</div>
                        <div class="calendar-day other-month">28</div>
                        <div class="calendar-day other-month">29</div>
                        <div class="calendar-day other-month">30</div>
                        <div class="calendar-day">1</div>
                        <div class="calendar-day">2</div>
                        <div class="calendar-day">3</div>
                        <div class="calendar-day">4</div>
                        <div class="calendar-day">5</div>
                        <div class="calendar-day">6</div>
                        <div class="calendar-day">7</div>
                        <div class="calendar-day">8</div>
                        <div class="calendar-day">9</div>
                        <div class="calendar-day">10</div>
                        <div class="calendar-day">11</div>
                        <div class="calendar-day">12</div>
                        <div class="calendar-day">13</div>
                        <div class="calendar-day">14</div>
                        <div class="calendar-day">15</div>
                        <div class="calendar-day">16</div>
                        <div class="calendar-day today">17</div>
                        <div class="calendar-day">18</div>
                        <div class="calendar-day">19</div>
                        <div class="calendar-day">20</div>
                        <div class="calendar-day">21</div>
                        <div class="calendar-day">22</div>
                        <div class="calendar-day">23</div>
                        <div class="calendar-day">24</div>
                        <div class="calendar-day">25</div>
                        <div class="calendar-day">26</div>
                        <div class="calendar-day">27</div>
                        <div class="calendar-day">28</div>
                        <div class="calendar-day">29</div>
                        <div class="calendar-day">30</div>
                        <div class="calendar-day">31</div>
                        <div class="calendar-day other-month">1</div>
                        <div class="calendar-day other-month">2</div>
                        <div class="calendar-day other-month">3</div>
                        <div class="calendar-day other-month">4</div>
                        <div class="calendar-day other-month">5</div>
                        <div class="calendar-day other-month">6</div>
                    </div>
                </div>

                <!-- Today's Schedule -->
                <div class="today-schedule">
                    <h3><i class="fas fa-calendar-day"></i> Lịch dạy hôm nay</h3>
                    <div class="schedule-list">
                        <div class="empty-state">
                            <p>Đang tải lịch dạy hôm nay...</p>
                        </div>
                    </div>
                </div>

                <!-- Weekly Overview -->
                <div class="weekly-overview">
                    <h3><i class="fas fa-calendar-week"></i> Tổng quan tuần</h3>
                    <div class="week-stats">
                        <div class="week-stat">
                            <span class="stat-number">15</span>
                            <span class="stat-label">Tiết dạy</span>
                        </div>
                        <div class="week-stat">
                            <span class="stat-number">22.5</span>
                            <span class="stat-label">Giờ dạy</span>
                        </div>
                        <div class="week-stat">
                            <span class="stat-number">125</span>
                            <span class="stat-label">Học sinh</span>
                        </div>
                        <div class="week-stat">
                            <span class="stat-number">3</span>
                            <span class="stat-label">Lớp học</span>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Messages Section -->
            <section class="content-section" id="messages">
                <div class="section-header">
                    <h2>Tin nhắn</h2>
                    <div class="header-actions">
                        <div class="connection-status">
                            <span class="status-indicator" id="connectionStatus"></span>
                            <span id="connectionText">Đang kết nối...</span>
                        </div>
                        <button class="btn btn-secondary" onclick="markAllAsRead()">
                            <i class="fas fa-check-double"></i>
                            Đánh dấu đã đọc
                        </button>
                        <button class="btn btn-primary" onclick="sendMessage()">
                            <i class="fas fa-plus"></i>
                            Soạn tin mới
                        </button>
                    </div>
                </div>

                <!-- Message Filters -->
                <div class="message-filters">
                    <div class="filter-tabs">
                        <button class="filter-tab active" onclick="filterMessages('all')">
                            <i class="fas fa-inbox"></i> Tất cả
                        </button>
                        <button class="filter-tab" onclick="filterMessages('unread')">
                            <i class="fas fa-envelope"></i> Chưa đọc
                        </button>
                        <button class="filter-tab" onclick="filterMessages('students')">
                            <i class="fas fa-user-graduate"></i> Học sinh
                        </button>
                        <button class="filter-tab" onclick="filterMessages('parents')">
                            <i class="fas fa-users"></i> Phụ huynh
                        </button>
                        <button class="filter-tab" onclick="filterMessages('admin')">
                            <i class="fas fa-cog"></i> Admin
                        </button>
                    </div>
                    <div class="search-box">
                        <input type="text" id="messageSearch" placeholder="Tìm kiếm tin nhắn..." onkeyup="searchMessages()">
                        <i class="fas fa-search"></i>
                    </div>
                </div>

                <!-- Message Statistics -->
                <div class="message-stats">
                    <div class="stat-item">
                        <span class="stat-number" id="totalMessages">4</span>
                        <span class="stat-label">Tổng tin nhắn</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-number" id="unreadMessages">3</span>
                        <span class="stat-label">Chưa đọc</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-number" id="todayMessages">2</span>
                        <span class="stat-label">Hôm nay</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-number" id="urgentMessages">1</span>
                        <span class="stat-label">Khẩn cấp</span>
                    </div>
                </div>
                
                <div class="messages-container" id="messagesContainer">
                    <div class="message-item unread">
                        <div class="message-avatar">
                            <i class="fas fa-user"></i>
                        </div>
                        <div class="message-content">
                            <div class="message-header">
                                <h4>Nguyễn Văn An (10A1)</h4>
                                <span class="message-time">2 giờ trước</span>
                            </div>
                            <p class="message-subject">Thắc mắc về bài tập số 3</p>
                            <p class="message-preview">Thưa cô, em có thắc mắc về bài tập số 3 trong chương Đại số. Em không hiểu cách giải phương trình bậc hai...</p>
                        </div>
                        <div class="message-actions">
                            <button class="btn btn-sm btn-primary" onclick="replyMessage(1)">
                                <i class="fas fa-reply"></i> Trả lời
                            </button>
                            <button class="btn btn-sm btn-secondary" onclick="viewMessage(1)">
                                <i class="fas fa-eye"></i> Xem
                            </button>
                        </div>
                        <div class="message-status">
                            <span class="status-dot unread"></span>
                        </div>
                    </div>

                    <div class="message-item">
                        <div class="message-avatar">
                            <i class="fas fa-user-tie"></i>
                        </div>
                        <div class="message-content">
                            <div class="message-header">
                                <h4>Phụ huynh Trần Thị B</h4>
                                <span class="message-time">4 giờ trước</span>
                            </div>
                            <p class="message-subject">Xin phép nghỉ học</p>
                            <p class="message-preview">Kính gửi cô, tôi xin phép cho cháu nghỉ học buổi chiều ngày mai vì có việc gia đình...</p>
                        </div>
                        <div class="message-actions">
                            <button class="btn btn-sm btn-primary" onclick="replyMessage(2)">
                                <i class="fas fa-reply"></i> Trả lời
                            </button>
                            <button class="btn btn-sm btn-secondary" onclick="viewMessage(2)">
                                <i class="fas fa-eye"></i> Xem
                            </button>
                        </div>
                        <div class="message-status">
                            <span class="status-dot"></span>
                        </div>
                    </div>

                    <div class="message-item unread">
                        <div class="message-avatar">
                            <i class="fas fa-cog"></i>
                        </div>
                        <div class="message-content">
                            <div class="message-header">
                                <h4>Admin MathBridge</h4>
                                <span class="message-time">1 ngày trước</span>
                            </div>
                            <p class="message-subject">Thông báo bảo trì hệ thống</p>
                            <p class="message-preview">Kính gửi quý thầy cô, hệ thống sẽ được bảo trì vào Chủ nhật từ 2:00-4:00 sáng...</p>
                        </div>
                        <div class="message-actions">
                            <button class="btn btn-sm btn-primary" onclick="replyMessage(3)">
                                <i class="fas fa-reply"></i> Trả lời
                            </button>
                            <button class="btn btn-sm btn-secondary" onclick="viewMessage(3)">
                                <i class="fas fa-eye"></i> Xem
                            </button>
                        </div>
                        <div class="message-status">
                            <span class="status-dot unread"></span>
                        </div>
                    </div>

                    <div class="message-item">
                        <div class="message-avatar">
                            <i class="fas fa-user"></i>
                        </div>
                        <div class="message-content">
                            <div class="message-header">
                                <h4>Lê Văn C (11B2)</h4>
                                <span class="message-time">2 ngày trước</span>
                            </div>
                            <p class="message-subject">Xin tài liệu ôn tập</p>
                            <p class="message-preview">Thưa thầy, em có thể xin tài liệu ôn tập cho kỳ thi sắp tới không ạ?</p>
                        </div>
                        <div class="message-actions">
                            <button class="btn btn-sm btn-primary" onclick="replyMessage(4)">
                                <i class="fas fa-reply"></i> Trả lời
                            </button>
                            <button class="btn btn-sm btn-secondary" onclick="viewMessage(4)">
                                <i class="fas fa-eye"></i> Xem
                            </button>
                        </div>
                        <div class="message-status">
                            <span class="status-dot"></span>
                        </div>
                    </div>
                </div>

                <!-- Message Statistics -->
                <div class="message-stats">
                    <div class="stat-item">
                        <span class="stat-number">12</span>
                        <span class="stat-label">Tin nhắn mới</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-number">45</span>
                        <span class="stat-label">Tổng tin nhắn</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-number">8</span>
                        <span class="stat-label">Chưa trả lời</span>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <!-- Modals -->
    <div class="modal profile-modal" id="profileModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Thông tin cá nhân</h3>
                <button class="modal-close" type="button" id="closeProfileModal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="profile-overview">
                    <div class="avatar" id="profileModalAvatar">GV</div>
                    <div class="meta">
                        <span class="name" id="profileModalName">Giáo viên MathBridge</span>
                        <span class="email" id="profileModalEmail">teacher@mathbridge.vn</span>
                        <span class="helper" id="profileModalCampus">Cơ sở: MathBridge Center</span>
                    </div>
                </div>
                <form class="profile-form" id="profileForm">
                    <div class="group-title">Thông tin cơ bản</div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="profileHo">Họ</label>
                            <input type="text" id="profileHo" name="ho" placeholder="VD: Nguyễn">
                        </div>
                        <div class="form-group">
                            <label for="profileTenDem">Tên đệm</label>
                            <input type="text" id="profileTenDem" name="tenDem" placeholder="VD: Văn">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="profileTen">Tên</label>
                            <input type="text" id="profileTen" name="ten" placeholder="VD: Huy">
                        </div>
                        <div class="form-group">
                            <label for="profileGioiTinh">Giới tính</label>
                            <select id="profileGioiTinh" name="gioiTinh">
                                <option value="">Chọn giới tính</option>
                                <option value="true">Nam</option>
                                <option value="false">Nữ</option>
                            </select>
                        </div>
                    </div>

                    <div class="group-title">Liên hệ & Chuyên môn</div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="profileSdt">Số điện thoại</label>
                            <input type="tel" id="profileSdt" name="sdt" placeholder="VD: 0901 234 567">
                        </div>
                        <div class="form-group">
                            <label for="profileKinhNghiem">Kinh nghiệm (năm)</label>
                            <input type="number" min="0" id="profileKinhNghiem" name="kinhNghiem" placeholder="VD: 5">
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="profileChuyenMon">Chuyên môn</label>
                        <input type="text" id="profileChuyenMon" name="chuyenMon" placeholder="VD: Đại số nâng cao">
                    </div>
                    <span class="helper">Thông tin này dùng để hiển thị trên portal giáo viên và hỗ trợ phụ huynh liên hệ nhanh chóng.</span>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-ghost" type="button" id="cancelProfileChanges">Đóng</button>
                <button class="btn btn-brand" type="button" id="saveProfileChanges">
                    <i class="fas fa-save"></i>
                    Lưu thay đổi
                </button>
            </div>
        </div>
    </div>

    <div class="modal" id="addClassModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Thêm lớp học mới</h3>
                <button class="modal-close" id="closeAddClassModal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <form id="addClassForm">
                    <div class="form-group">
                        <label for="className">Tên lớp</label>
                        <input type="text" id="className" class="form-input" required>
                    </div>
                    <div class="form-group">
                        <label for="classSubject">Môn học</label>
                        <select id="classSubject" class="form-select" required>
                            <option value="">Chọn môn học</option>
                            <option value="math">Toán học</option>
                            <option value="physics">Vật lý</option>
                            <option value="chemistry">Hóa học</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="classSchedule">Lịch học</label>
                        <input type="text" id="classSchedule" class="form-input" placeholder="VD: Thứ 2, 4, 6 - 8:00-9:30">
                    </div>
                    <div class="form-group">
                        <label for="classRoom">Phòng học</label>
                        <input type="text" id="classRoom" class="form-input">
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="cancelAddClass">Hủy</button>
                <button class="btn btn-primary" id="saveAddClass">Lưu</button>
            </div>
        </div>
    </div>

    <script src="../assets/js/teacher-main.js"></script>
    <script src="../assets/js/teacher-functions.js"></script>
    

    <!-- Students Modal -->
    <div class="modal" id="studentsModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="studentsModalTitle">Danh sách học sinh</h3>
                <button class="modal-close" onclick="closeStudentsModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="students-modal-actions">
                    <div class="search-box">
                        <input type="text" id="modalStudentSearch" placeholder="Tìm kiếm học sinh...">
                        <i class="fas fa-search"></i>
                    </div>
                    <button class="btn btn-primary" onclick="addStudentToClass()">
                        <i class="fas fa-plus"></i> Thêm học sinh
                    </button>
                    <button class="btn btn-success" onclick="importStudentsToClass()">
                        <i class="fas fa-upload"></i> Import
                    </button>
                </div>
                
                <div class="students-list" id="studentsList">
                    <!-- Students will be loaded here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Class Details Modal -->
    <div class="modal" id="classDetailsModal">
        <div class="modal-content large-modal">
            <div class="modal-header">
                <h3 id="classDetailsTitle">Chi tiết lớp học</h3>
                <button class="modal-close" onclick="closeClassDetailsModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="class-details-tabs">
                    <button class="tab-btn active" onclick="showClassTab('sessions')">
                        <i class="fas fa-calendar-alt"></i> Danh sách buổi học
                    </button>
                    <button class="tab-btn" onclick="showClassTab('students')">
                        <i class="fas fa-users"></i> Danh sách học sinh
                    </button>
                    <button class="tab-btn" onclick="showClassTab('assignments')">
                        <i class="fas fa-tasks"></i> Bài tập
                    </button>
                </div>

                <!-- Sessions Tab -->
                <div class="tab-content active" id="sessionsTab">
                    <div class="sessions-header">
                        <h4>Danh sách buổi học</h4>
                        <button class="btn btn-primary" onclick="addNewSession()">
                            <i class="fas fa-plus"></i> Thêm buổi học
                        </button>
                    </div>
                    <div class="sessions-list" id="sessionsList">
                        <!-- Sessions will be loaded here -->
                    </div>
                </div>

                <!-- Students Tab -->
                <div class="tab-content" id="studentsTab">
                    <div class="students-header">
                        <h4>Danh sách học sinh</h4>
                        <button class="btn btn-primary" onclick="addStudentToClass()">
                            <i class="fas fa-plus"></i> Thêm học sinh
                        </button>
                    </div>
                    <div class="students-table-container">
                        <table class="students-table">
                            <thead>
                                <tr>
                                    <th>Họ tên</th>
                                    <th>Email</th>
                                    <th>Điểm TB</th>
                                    <th>Trạng thái</th>
                                    <th>Hành động</th>
                                </tr>
                            </thead>
                            <tbody id="classStudentsList">
                                <!-- Students will be loaded here -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Assignments Tab -->
                <div class="tab-content" id="assignmentsTab">
                    <div class="assignments-header">
                        <h4>Bài tập của lớp</h4>
                        <button class="btn btn-primary" onclick="createAssignmentForClass()">
                            <i class="fas fa-plus"></i> Tạo bài tập
                        </button>
                    </div>
                    <div class="assignments-list" id="classAssignmentsList">
                        <!-- Assignments will be loaded here -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Session Details Modal -->
    <div class="modal" id="sessionDetailsModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="sessionDetailsTitle">Chi tiết buổi học</h3>
                <button class="modal-close" onclick="closeSessionDetailsModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="session-info">
                    <div class="info-row">
                        <label>Ngày học:</label>
                        <span id="sessionDate"></span>
                    </div>
                    <div class="info-row">
                        <label>Thời gian:</label>
                        <span id="sessionTime"></span>
                    </div>
                    <div class="info-row">
                        <label>Chủ đề:</label>
                        <span id="sessionTopic"></span>
                    </div>
                    <div class="info-row">
                        <label>Trạng thái:</label>
                        <span id="sessionStatus"></span>
                    </div>
                </div>

                <div class="session-content">
                    <h4>Nhận xét buổi học</h4>
                    <div class="session-comments" id="sessionComments">
                        <!-- Comments will be loaded here -->
                    </div>
                    
                    <h4>Bài tập về nhà</h4>
                    <div class="homework-list" id="homeworkList">
                        <!-- Homework will be loaded here -->
                    </div>
                </div>

                <div class="session-actions">
                    <button class="btn btn-primary" onclick="addSessionComment()">
                        <i class="fas fa-comment"></i> Thêm nhận xét
                    </button>
                    <button class="btn btn-success" onclick="addHomework()">
                        <i class="fas fa-book"></i> Thêm bài tập
                    </button>
                    <button class="btn btn-info" onclick="exportSessionReport()">
                        <i class="fas fa-download"></i> Xuất báo cáo
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Class Management Modal -->
    <div class="modal" id="classManagementModal">
        <div class="modal-content large-modal">
            <div class="modal-header">
                <h3 id="classManagementTitle">Quản lý lớp học</h3>
                <button class="modal-close" onclick="closeClassManagementModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="management-tabs">
                    <button class="tab-btn active" onclick="showManagementTab('attendance')">
                        <i class="fas fa-clipboard-check"></i> Điểm danh
                    </button>
                    <button class="tab-btn" onclick="showManagementTab('grading')">
                        <i class="fas fa-star"></i> Chấm điểm
                    </button>
                    <button class="tab-btn" onclick="showManagementTab('evaluation')">
                        <i class="fas fa-chart-line"></i> Đánh giá
                    </button>
                </div>

                <!-- Attendance Tab -->
                <div class="tab-content active" id="attendanceTab">
                    <div class="attendance-header">
                        <h4>Điểm danh lớp học</h4>
                        <div class="attendance-actions">
                            <button class="btn btn-success" onclick="markAllPresent()">
                                <i class="fas fa-check-double"></i> Điểm danh tất cả
                            </button>
                            <button class="btn btn-warning" onclick="markAllAbsent()">
                                <i class="fas fa-times"></i> Vắng tất cả
                            </button>
                        </div>
                    </div>
                    <div class="attendance-list" id="attendanceList">
                        <!-- Attendance will be loaded here -->
                    </div>
                </div>

                <!-- Grading Tab -->
                <div class="tab-content" id="gradingTab">
                    <div class="grading-header">
                        <h4>Chấm điểm thường xuyên</h4>
                        <div class="grading-actions">
                            <button class="btn btn-primary" onclick="addQuickGrade()">
                                <i class="fas fa-plus"></i> Thêm điểm nhanh
                            </button>
                            <button class="btn btn-info" onclick="bulkGrading()">
                                <i class="fas fa-edit"></i> Chấm hàng loạt
                            </button>
                        </div>
                    </div>
                    <div class="grading-list" id="gradingList">
                        <!-- Grading will be loaded here -->
                    </div>
                </div>

                <!-- Evaluation Tab -->
                <div class="tab-content" id="evaluationTab">
                    <div class="evaluation-header">
                        <h4>Đánh giá học sinh</h4>
                        <div class="evaluation-actions">
                            <button class="btn btn-primary" onclick="addEvaluation()">
                                <i class="fas fa-plus"></i> Thêm đánh giá
                            </button>
                            <button class="btn btn-success" onclick="exportEvaluations()">
                                <i class="fas fa-download"></i> Xuất báo cáo
                            </button>
                        </div>
                    </div>
                    <div class="evaluation-list" id="evaluationList">
                        <!-- Evaluations will be loaded here -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script>
        if (window.__DISABLE_LEGACY_TEACHER_DEMO__) {
            console.debug('Legacy teacher demo script skipped');
        } else {
        // Debug script to check if everything is loaded
        console.log('=== DEBUG SCRIPT LOADED ===');
        console.log('TeacherDashboard:', typeof window.TeacherDashboard);
        console.log('TeacherAPI:', typeof window.TeacherAPI);
        console.log('NotificationManager:', typeof window.NotificationManager);
        console.log('manageStudents:', typeof window.manageStudents);
        console.log('viewClassDetails:', typeof window.viewClassDetails);
        console.log('bulkImportStudents:', typeof window.bulkImportStudents);
        console.log('addClass:', typeof window.addClass);
        console.log('openClassManagement:', typeof window.openClassManagement);
        
        
        
        window.manageClassStudents = function() {
            console.log('manageClassStudents called');
            alert('Quản lý học sinh - Chức năng đã hoạt động!');
        };
        
        window.classSettings = function() {
            console.log('classSettings called');
            alert('Cài đặt lớp - Chức năng đã hoạt động!');
        };
        
        window.bulkImportStudents = function() {
            console.log('bulkImportStudents called');
            alert('Import học sinh - Chức năng đã hoạt động!');
        };
        
        // Class card buttons
        window.manageStudents = function(classId) {
            console.log('manageStudents called with:', classId);
            alert('Quản lý học sinh lớp ' + classId + ' - Chức năng đã hoạt động!');
        };
        
        window.viewClassDetails = function(classId) {
            console.log('viewClassDetails called with:', classId);
            
            const classNames = {
                1: 'Toán 10A1',
                2: 'Toán 11B2', 
                3: 'Toán 12C1'
            };
            
            const className = classNames[classId] || `Lớp ${classId}`;
            const titleElement = document.getElementById('classDetailsTitle');
            if (titleElement) {
                titleElement.textContent = `Chi tiết lớp học - ${className}`;
            }
            
            // Load sessions data
            const sessionsList = document.getElementById('sessionsList');
            if (sessionsList) {
                const sessions = [
                    { id: 1, date: '12/10/2025', time: '8:00-9:30', topic: 'Phương trình bậc hai', status: 'completed' },
                    { id: 2, date: '14/10/2025', time: '8:00-9:30', topic: 'Hệ phương trình', status: 'upcoming' },
                    { id: 3, date: '16/10/2025', time: '8:00-9:30', topic: 'Bất phương trình', status: 'upcoming' }
                ];
                
                sessionsList.innerHTML = sessions.map(session => `
                    <div class="session-item">
                        <div class="session-date">${session.date}</div>
                        <div class="session-time">${session.time}</div>
                        <div class="session-topic">${session.topic}</div>
                        <div class="session-status ${session.status}">${getSessionStatusText(session.status)}</div>
                        <div class="session-actions">
                            <button class="btn btn-sm btn-primary" onclick="viewSessionDetails(${session.id})">
                                <i class="fas fa-eye"></i> Xem
                            </button>
                        </div>
                    </div>
                `).join('');
            }
            
            // Show modal
            const modal = document.getElementById('classDetailsModal');
            if (modal) {
                modal.classList.add('active');
                showNotification(`Đang hiển thị chi tiết lớp ${className}!`, 'info');
            }
        };
        
        
        window.editClass = function(classId) {
            console.log('editClass called with:', classId);
            alert('Chỉnh sửa lớp ' + classId + ' - Chức năng đã hoạt động!');
        };
        
        window.deleteClass = function(classId) {
            console.log('deleteClass called with:', classId);
            alert('Xóa lớp ' + classId + ' - Chức năng đã hoạt động!');
        };
        
        // Assignment functions - now handled by teacher-functions.js
        
        window.assignToStudents = async function() {
            console.log('assignToStudents called');
            // Open create assignment modal
            if (typeof createAssignment === 'function') {
                createAssignment();
            } else {
                showNotification('Vui lòng chọn lớp học để giao bài tập', 'info');
            }
        };
        
        window.bulkGradeAssignments = function() {
            console.log('bulkGradeAssignments called');
            alert('Chấm điểm hàng loạt - Chức năng đã hoạt động!');
        };
        
        window.assignmentTemplates = function() {
            console.log('assignmentTemplates called');
            alert('Mẫu bài tập - Chức năng đã hoạt động!');
        };
        
        // Grade functions
        window.viewGrades = function() {
            console.log('viewGrades called');
            alert('Xem điểm số - Chức năng đã hoạt động!');
        };
        
        window.filterGrades = function() {
            console.log('filterGrades called');
            alert('Lọc điểm số - Chức năng đã hoạt động!');
        };
        
        // exportGrades is now in teacher-functions.js
        
        window.generateGradeReport = function() {
            console.log('generateGradeReport called');
            alert('Tạo báo cáo điểm - Chức năng đã hoạt động!');
        };
        
        window.sendGradeNotification = function() {
            console.log('sendGradeNotification called');
            alert('Gửi thông báo điểm - Chức năng đã hoạt động!');
        };
        
        window.editGrade = function(studentId, classId) {
            console.log('editGrade called with:', studentId, classId);
            // Navigate to grades section and filter by class
            if (window.teacherDashboard) {
                window.teacherDashboard.navigateToSection('grades');
            }
            if (typeof viewDiemSo === 'function') {
                viewDiemSo(classId);
            }
        };
        
        window.deleteGrade = function(gradeId) {
            console.log('deleteGrade called with:', gradeId);
            alert('Xóa điểm ' + gradeId + ' - Chức năng đã hoạt động!');
        };
        
        window.bulkUpdateGrades = function() {
            console.log('bulkUpdateGrades called');
            alert('Cập nhật điểm hàng loạt - Chức năng đã hoạt động!');
        };
        
        window.viewGradeDetails = function(gradeId) {
            console.log('viewGradeDetails called with:', gradeId);
            alert('Xem chi tiết điểm ' + gradeId + ' - Chức năng đã hoạt động!');
        };
        
        window.addGrade = function() {
            console.log('addGrade called');
            alert('Thêm điểm mới - Chức năng đã hoạt động!');
        };
        
        window.calculateAverage = function() {
            console.log('calculateAverage called');
            alert('Tính điểm trung bình - Chức năng đã hoạt động!');
        };
        
        window.setGradeFilter = function(filterType) {
            console.log('setGradeFilter called with:', filterType);
            alert('Lọc điểm theo ' + filterType + ' - Chức năng đã hoạt động!');
        };
        
        window.clearGradeFilter = function() {
            console.log('clearGradeFilter called');
            alert('Xóa bộ lọc điểm - Chức năng đã hoạt động!');
        };
        
        window.sortGrades = function(sortBy) {
            console.log('sortGrades called with:', sortBy);
            alert('Sắp xếp điểm theo ' + sortBy + ' - Chức năng đã hoạt động!');
        };
        
        // Grade filter and import functions
        window.filterGradesByClass = async function(className) {
            console.log('filterGradesByClass called with:', className);
            if (className && typeof viewDiemSo === 'function') {
                await viewDiemSo(className);
            } else {
                showNotification('Vui lòng chọn lớp học', 'warning');
            }
        };
        
        window.importGrades = function() {
            console.log('importGrades called');
            alert('Nhập điểm - Chức năng đã hoạt động!');
        };
        
        window.exportReport = function() {
            console.log('exportReport called');
            alert('Xuất báo cáo - Chức năng đã hoạt động!');
        };
        
        window.filterBySubject = function(subject) {
            console.log('filterBySubject called with:', subject);
            alert('Lọc điểm theo môn ' + subject + ' - Chức năng đã hoạt động!');
        };
        
        window.filterByDate = function(dateRange) {
            console.log('filterByDate called with:', dateRange);
            alert('Lọc điểm theo ngày ' + dateRange + ' - Chức năng đã hoạt động!');
        };
        
        window.filterByGrade = function(gradeRange) {
            console.log('filterByGrade called with:', gradeRange);
            alert('Lọc điểm theo khoảng ' + gradeRange + ' - Chức năng đã hoạt động!');
        };
        
        window.clearAllFilters = function() {
            console.log('clearAllFilters called');
            alert('Xóa tất cả bộ lọc - Chức năng đã hoạt động!');
        };
        
        window.refreshGrades = function() {
            console.log('refreshGrades called');
            alert('Làm mới danh sách điểm - Chức năng đã hoạt động!');
        };
        
        window.bulkImportGrades = function() {
            console.log('bulkImportGrades called');
            alert('Nhập điểm hàng loạt - Chức năng đã hoạt động!');
        };
        
        window.downloadGradeTemplate = function() {
            console.log('downloadGradeTemplate called');
            alert('Tải mẫu nhập điểm - Chức năng đã hoạt động!');
        };
        
        // Schedule functions
        window.viewSchedule = function() {
            console.log('viewSchedule called');
            alert('Xem lịch dạy - Chức năng đã hoạt động!');
        };
        
        window.addSchedule = function() {
            console.log('addSchedule called');
            alert('Thêm lịch dạy - Chức năng đã hoạt động!');
        };
        
        window.editSchedule = function(scheduleId) {
            console.log('editSchedule called with:', scheduleId);
            alert('Chỉnh sửa lịch dạy ' + scheduleId + ' - Chức năng đã hoạt động!');
        };
        
        window.deleteSchedule = function(scheduleId) {
            console.log('deleteSchedule called with:', scheduleId);
            alert('Xóa lịch dạy ' + scheduleId + ' - Chức năng đã hoạt động!');
        };
        
        window.startClass = function(classId) {
            console.log('startClass called with:', classId);
            alert('Bắt đầu lớp ' + classId + ' - Chức năng đã hoạt động!');
        };
        
        window.pauseClass = function(classId) {
            console.log('pauseClass called with:', classId);
            alert('Tạm dừng lớp ' + classId + ' - Chức năng đã hoạt động!');
        };
        
        window.resumeClass = function(classId) {
            console.log('resumeClass called with:', classId);
            alert('Tiếp tục lớp ' + classId + ' - Chức năng đã hoạt động!');
        };
        
        window.viewClassDetails = function(classId) {
            console.log('viewClassDetails called with:', classId);
            
            const classNames = {
                1: 'Toán 10A1',
                2: 'Toán 11B2', 
                3: 'Toán 12C1'
            };
            
            const className = classNames[classId] || `Lớp ${classId}`;
            const titleElement = document.getElementById('classDetailsTitle');
            if (titleElement) {
                titleElement.textContent = `Chi tiết lớp học - ${className}`;
            }
            
            // Load sessions data
            const sessionsList = document.getElementById('sessionsList');
            if (sessionsList) {
                const sessions = [
                    { id: 1, date: '12/10/2025', time: '8:00-9:30', topic: 'Phương trình bậc hai', status: 'completed' },
                    { id: 2, date: '14/10/2025', time: '8:00-9:30', topic: 'Hệ phương trình', status: 'upcoming' },
                    { id: 3, date: '16/10/2025', time: '8:00-9:30', topic: 'Bất phương trình', status: 'upcoming' }
                ];
                
                sessionsList.innerHTML = sessions.map(session => `
                    <div class="session-item">
                        <div class="session-date">${session.date}</div>
                        <div class="session-time">${session.time}</div>
                        <div class="session-topic">${session.topic}</div>
                        <div class="session-status ${session.status}">${getSessionStatusText(session.status)}</div>
                        <div class="session-actions">
                            <button class="btn btn-sm btn-primary" onclick="viewSessionDetails(${session.id})">
                                <i class="fas fa-eye"></i> Xem
                            </button>
                        </div>
                    </div>
                `).join('');
            }
            
            // Show modal
            const modal = document.getElementById('classDetailsModal');
            if (modal) {
                modal.classList.add('active');
                showNotification(`Đang hiển thị chi tiết lớp ${className}!`, 'info');
            }
        };
        
        window.reviewClass = function(classId) {
            console.log('reviewClass called with:', classId);
            showNotification(`Đánh giá lớp ${classId}`, 'info');
        };
        
        // Message functions
        window.viewMessages = function() {
            console.log('viewMessages called');
            
            // Load messages with correct data structure
            const messagesContainer = document.querySelector('.messages-list');
            if (messagesContainer) {
                const messages = [
                    { id: 1, sender: 'Nguyễn Văn An (10A1)', subject: 'Thắc mắc về bài tập số 3', time: '2 giờ trước', type: 'normal', read: false, senderType: 'student' },
                    { id: 2, sender: 'Phụ huynh Trần Thị B', subject: 'Xin phép nghỉ học', time: '4 giờ trước', type: 'normal', read: false, senderType: 'parent' },
                    { id: 3, sender: 'Admin MathBridge', subject: 'Thông báo bảo trì hệ thống', time: '1 ngày trước', type: 'urgent', read: false, senderType: 'admin' },
                    { id: 4, sender: 'Lê Văn C (11B2)', subject: 'Xin tài liệu ôn tập', time: '2 ngày trước', type: 'normal', read: true, senderType: 'student' }
                ];
                
                messagesContainer.innerHTML = messages.map(message => `
                    <div class="message-item ${message.read ? 'read' : 'unread'} ${message.type}" data-type="${message.type}">
                        <div class="message-avatar">
                            <i class="fas fa-user"></i>
                        </div>
                        <div class="message-content">
                            <div class="message-header">
                                <div class="message-sender">${message.sender}</div>
                                <div class="message-time">${message.time}</div>
                            </div>
                            <div class="message-subject">${message.subject}</div>
                            <div class="message-preview">Nội dung tin nhắn...</div>
                        </div>
                        <div class="message-actions">
                            <button class="btn btn-sm btn-primary" onclick="viewMessage(${message.id})">
                                <i class="fas fa-eye"></i> Xem
                            </button>
                            <button class="btn btn-sm btn-success" onclick="replyMessage(${message.id})">
                                <i class="fas fa-reply"></i> Trả lời
                            </button>
                            <button class="btn btn-sm btn-info" onclick="markAsRead(${message.id})">
                                <i class="fas fa-envelope"></i> Đánh dấu đã đọc
                            </button>
                            <button class="btn btn-sm btn-warning" onclick="viewReplyHistory(${message.id})">
                                <i class="fas fa-history"></i> Lịch sử
                            </button>
                            <button class="btn btn-sm btn-danger" onclick="deleteMessage(${message.id})">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>
                `).join('');
            }
            
            // Update statistics
            const totalMessages = document.getElementById('totalMessages');
            const unreadMessages = document.getElementById('unreadMessages');
            const todayMessages = document.getElementById('todayMessages');
            const urgentMessages = document.getElementById('urgentMessages');
            
            if (totalMessages) totalMessages.textContent = messages.length;
            if (unreadMessages) unreadMessages.textContent = messages.filter(m => !m.read).length;
            if (todayMessages) todayMessages.textContent = messages.filter(m => m.time.includes('giờ trước') || m.time.includes('phút trước')).length;
            if (urgentMessages) urgentMessages.textContent = messages.filter(m => m.type === 'urgent').length;
            
            showNotification('Đã tải danh sách tin nhắn', 'success');
        };
        
        window.sendMessage = function() {
            console.log('sendMessage called');
            showNotification('Gửi tin nhắn', 'info');
        };
        
        window.replyMessage = function(messageId) {
            console.log('replyMessage called with:', messageId);
            
            // Create reply modal
            const modal = document.createElement('div');
            modal.className = 'modal active';
            modal.innerHTML = `
                <div class="modal-content">
                    <div class="modal-header">
                        <h3>Trả lời tin nhắn</h3>
                        <button class="modal-close" onclick="this.closest('.modal').remove()">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    <div class="modal-body">
                        <div class="reply-form">
                            <div class="form-group">
                                <label>Người nhận:</label>
                                <input type="text" class="form-control" value="Nguyễn Văn An (10A1)" readonly>
                            </div>
                            <div class="form-group">
                                <label>Tiêu đề:</label>
                                <input type="text" class="form-control" value="Re: Hỏi về bài tập toán" placeholder="Nhập tiêu đề">
                            </div>
                            <div class="form-group">
                                <label>Nội dung trả lời:</label>
                                <textarea class="form-control" rows="8" placeholder="Nhập nội dung trả lời...">Chào em,

Cảm ơn em đã hỏi về bài tập. Để giải phương trình bậc hai, em cần:

1. Đưa phương trình về dạng ax² + bx + c = 0
2. Tính delta = b² - 4ac
3. Nếu delta > 0: có 2 nghiệm phân biệt
4. Nếu delta = 0: có 1 nghiệm kép
5. Nếu delta < 0: vô nghiệm

Em có thể làm theo các bước trên. Nếu còn thắc mắc, em cứ hỏi thêm nhé!

Thầy/cô</textarea>
                            </div>
                            <div class="form-actions">
                                <button class="btn btn-primary" onclick="sendReply(${messageId})">
                                    <i class="fas fa-paper-plane"></i> Gửi trả lời
                                </button>
                                <button class="btn btn-secondary" onclick="this.closest('.modal').remove()">
                                    <i class="fas fa-times"></i> Hủy
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            showNotification(`Đang soạn trả lời tin nhắn ${messageId}`, 'info');
        };
        
        window.sendReply = function(messageId) {
            console.log('sendReply called with:', messageId);
            showNotification('Đã gửi trả lời tin nhắn!', 'success');
            
            // Close reply modal
            const replyModal = document.querySelector('.modal.active');
            if (replyModal) {
                replyModal.remove();
            }
        };
        
        window.deleteMessage = function(messageId) {
            console.log('deleteMessage called with:', messageId);
            showNotification(`Xóa tin nhắn ${messageId}`, 'info');
        };
        
        window.markAsRead = function(messageId) {
            console.log('markAsRead called with:', messageId);
            
            // Find the message item and mark as read
            const messageItems = document.querySelectorAll('.message-item');
            messageItems.forEach(item => {
                const messageActions = item.querySelector('.message-actions');
                if (messageActions && messageActions.innerHTML.includes(`markAsRead(${messageId})`)) {
                    item.classList.remove('unread');
                    item.classList.add('read');
                    
                    // Update the message actions to show "Mark as unread"
                    const markButton = messageActions.querySelector(`[onclick="markAsRead(${messageId})"]`);
                    if (markButton) {
                        markButton.innerHTML = '<i class="fas fa-envelope-open"></i> Đánh dấu chưa đọc';
                        markButton.setAttribute('onclick', `markAsUnread(${messageId})`);
                    }
                }
            });
            
            // Update statistics
            updateMessageStats();
            showNotification(`Đã đánh dấu tin nhắn ${messageId} là đã đọc`, 'success');
        };
        
        window.markAsUnread = function(messageId) {
            console.log('markAsUnread called with:', messageId);
            
            // Find the message item and mark as unread
            const messageItems = document.querySelectorAll('.message-item');
            messageItems.forEach(item => {
                const messageActions = item.querySelector('.message-actions');
                if (messageActions && messageActions.innerHTML.includes(`markAsUnread(${messageId})`)) {
                    item.classList.remove('read');
                    item.classList.add('unread');
                    
                    // Update the message actions to show "Mark as read"
                    const markButton = messageActions.querySelector(`[onclick="markAsUnread(${messageId})"]`);
                    if (markButton) {
                        markButton.innerHTML = '<i class="fas fa-envelope"></i> Đánh dấu đã đọc';
                        markButton.setAttribute('onclick', `markAsRead(${messageId})`);
                    }
                }
            });
            
            // Update statistics
            updateMessageStats();
            showNotification(`Đã đánh dấu tin nhắn ${messageId} là chưa đọc`, 'info');
        };
        
        // Update message statistics
        window.updateMessageStats = function() {
            const messageItems = document.querySelectorAll('.message-item');
            const totalMessages = messageItems.length;
            const unreadMessages = document.querySelectorAll('.message-item.unread').length;
            const todayMessages = document.querySelectorAll('.message-item').length; // Simplified for demo
            const urgentMessages = document.querySelectorAll('.message-item.urgent').length;
            
            const totalElement = document.getElementById('totalMessages');
            const unreadElement = document.getElementById('unreadMessages');
            const todayElement = document.getElementById('todayMessages');
            const urgentElement = document.getElementById('urgentMessages');
            
            if (totalElement) totalElement.textContent = totalMessages;
            if (unreadElement) unreadElement.textContent = unreadMessages;
            if (todayElement) todayElement.textContent = todayMessages;
            if (urgentElement) urgentElement.textContent = urgentMessages;
        };
        
        window.filterMessages = function(filterType) {
            console.log('filterMessages called with:', filterType);
            
            const messageItems = document.querySelectorAll('.message-item');
            let visibleCount = 0;
            
            console.log('Found message items:', messageItems.length);
            
            messageItems.forEach((item, index) => {
                const messageSender = item.querySelector('.message-sender')?.textContent || '';
                const isRead = item.classList.contains('read');
                const isImportant = item.classList.contains('important');
                const isUrgent = item.classList.contains('urgent');
                
                console.log(`Message ${index + 1}:`, {
                    sender: messageSender,
                    isRead: isRead,
                    isImportant: isImportant,
                    isUrgent: isUrgent
                });
                
                let shouldShow = true;
                
                switch(filterType) {
                    case 'unread':
                        shouldShow = !isRead;
                        break;
                    case 'read':
                        shouldShow = isRead;
                        break;
                    case 'students':
                        shouldShow = messageSender.includes('(10A1)') || messageSender.includes('(11B2)') || messageSender.includes('Lê Văn C') || messageSender.includes('Nguyễn Văn An') || messageSender.includes('Học sinh') || messageSender.includes('An') || messageSender.includes('Cường');
                        console.log(`Student filter for "${messageSender}": ${shouldShow}`);
                        break;
                    case 'parents':
                        shouldShow = messageSender.includes('Phụ huynh');
                        break;
                    case 'admin':
                        shouldShow = messageSender.includes('Admin') || messageSender.includes('Ban giám hiệu');
                        break;
                    case 'important':
                        shouldShow = isImportant;
                        break;
                    case 'urgent':
                        shouldShow = isUrgent;
                        break;
                    case 'all':
                    default:
                        shouldShow = true;
                        break;
                }
                
                if (shouldShow) {
                    item.style.display = 'flex';
                    visibleCount++;
                    console.log(`Showing message ${index + 1}`);
                } else {
                    item.style.display = 'none';
                    console.log(`Hiding message ${index + 1}`);
                }
            });
            
            showNotification(`Đã lọc tin nhắn theo ${filterType} - Hiển thị ${visibleCount} tin nhắn`, 'success');
        };
        
        window.searchMessages = function() {
            console.log('searchMessages called');
            showNotification('Tìm kiếm tin nhắn', 'info');
        };
        
        window.clearMessageFilter = function() {
            console.log('clearMessageFilter called');
            showNotification('Xóa bộ lọc tin nhắn', 'info');
        };
        
        window.exportMessages = function() {
            console.log('exportMessages called');
            showNotification('Xuất tin nhắn', 'success');
        };
        
        window.archiveMessage = function(messageId) {
            console.log('archiveMessage called with:', messageId);
            showNotification(`Lưu trữ tin nhắn ${messageId}`, 'success');
        };
        
        window.forwardMessage = function(messageId) {
            console.log('forwardMessage called with:', messageId);
            showNotification(`Chuyển tiếp tin nhắn ${messageId}`, 'info');
        };
        
        // Add missing viewMessage function
        window.viewMessage = function(messageId) {
            console.log('viewMessage called with:', messageId);
            
            // Create message detail modal
            const modal = document.createElement('div');
            modal.className = 'modal active';
            modal.innerHTML = `
                <div class="modal-content">
                    <div class="modal-header">
                        <h3>Chi tiết tin nhắn</h3>
                        <button class="modal-close" onclick="this.closest('.modal').remove()">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    <div class="modal-body">
                        <div class="message-detail">
                            <div class="message-detail-header">
                                <div class="message-detail-sender">
                                    <div class="message-avatar">
                                        <i class="fas fa-user"></i>
                                    </div>
                                    <div class="message-sender-info">
                                        <div class="sender-name">Nguyễn Văn An (10A1)</div>
                                        <div class="sender-role">Học sinh</div>
                                    </div>
                                </div>
                                <div class="message-detail-time">2 giờ trước</div>
                            </div>
                            <div class="message-detail-subject">
                                <h4>Hỏi về bài tập toán</h4>
                            </div>
                            <div class="message-detail-content">
                                <p>Thưa thầy/cô, em có thắc mắc về bài tập số 5 trang 45. Em không hiểu cách giải phương trình bậc hai này. Thầy/cô có thể giải thích giúp em được không ạ?</p>
                                <p>Em cảm ơn thầy/cô!</p>
                            </div>
                            <div class="message-detail-actions">
                                <button class="btn btn-primary" onclick="replyMessage(${messageId})">
                                    <i class="fas fa-reply"></i> Trả lời
                                </button>
                                <button class="btn btn-success" onclick="markAsRead(${messageId})">
                                    <i class="fas fa-check"></i> Đánh dấu đã đọc
                                </button>
                                <button class="btn btn-info" onclick="forwardMessage(${messageId})">
                                    <i class="fas fa-share"></i> Chuyển tiếp
                                </button>
                                <button class="btn btn-danger" onclick="deleteMessage(${messageId})">
                                    <i class="fas fa-trash"></i> Xóa
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            showNotification(`Đang hiển thị tin nhắn ${messageId}`, 'info');
        };
        
        // Additional missing functions
        window.showManagementTab = function(tabName) {
            console.log('showManagementTab called with:', tabName);
            showNotification(`Chuyển tab ${tabName}`, 'info');
        };
        
        window.loadClassDetails = function(classId) {
            console.log('loadClassDetails called with:', classId);
            showNotification(`Tải chi tiết lớp ${classId}`, 'success');
        };
        
        window.loadSessionsData = function(classId) {
            console.log('loadSessionsData called with:', classId);
            showNotification(`Tải dữ liệu buổi học lớp ${classId}`, 'success');
        };
        
        window.loadClassStudentsData = function(classId) {
            console.log('loadClassStudentsData called with:', classId);
            
            const studentsList = document.getElementById('studentsList');
            if (studentsList) {
                const students = [
                    { id: 1, name: 'Nguyễn Văn An', email: 'nguyenvana@email.com', grade: 8.5, attendance: 95, status: 'active' },
                    { id: 2, name: 'Trần Thị Bình', email: 'tranthib@email.com', grade: 7.0, attendance: 88, status: 'active' },
                    { id: 3, name: 'Lê Văn Cường', email: 'levanc@email.com', grade: 6.5, attendance: 92, status: 'active' },
                    { id: 4, name: 'Phạm Thị Dung', email: 'phamthid@email.com', grade: 9.0, attendance: 98, status: 'active' },
                    { id: 5, name: 'Hoàng Văn Em', email: 'hoangvane@email.com', grade: 8.0, attendance: 90, status: 'active' },
                    { id: 6, name: 'Vũ Thị Phương', email: 'vuthif@email.com', grade: 7.5, attendance: 85, status: 'active' },
                    { id: 7, name: 'Đặng Văn Giang', email: 'dangvang@email.com', grade: 8.8, attendance: 96, status: 'active' },
                    { id: 8, name: 'Bùi Thị Hoa', email: 'buithih@email.com', grade: 7.8, attendance: 89, status: 'active' },
                    { id: 9, name: 'Ngô Văn Inh', email: 'ngovani@email.com', grade: 8.2, attendance: 93, status: 'active' },
                    { id: 10, name: 'Lý Thị Kim', email: 'lythik@email.com', grade: 7.3, attendance: 87, status: 'active' }
                ];
                
                studentsList.innerHTML = `
                    <div class="students-header">
                        <h4>Danh sách học sinh (${students.length} học sinh)</h4>
                        <button class="btn btn-primary" onclick="addNewStudent(${classId})">
                            <i class="fas fa-plus"></i> Thêm học sinh
                        </button>
                    </div>
                    <div class="students-table">
                        <div class="table-header">
                            <div class="col-name">Họ tên</div>
                            <div class="col-email">Email</div>
                            <div class="col-grade">Điểm TB</div>
                            <div class="col-attendance">Trạng thái</div>
                            <div class="col-actions">Hành động</div>
                        </div>
                        ${students.map(student => `
                            <div class="table-row">
                                <div class="col-name">
                                    <div class="student-avatar">${student.name.split(' ').map(n => n[0]).join('')}</div>
                                    <div class="student-name">${student.name}</div>
                                </div>
                                <div class="col-email">${student.email}</div>
                                <div class="col-grade">
                                    <span class="grade-badge ${student.grade >= 8 ? 'excellent' : student.grade >= 7 ? 'good' : 'average'}">${student.grade}</span>
                                </div>
                                <div class="col-attendance">
                                    <span class="status-badge ${student.status}">${student.status === 'active' ? 'Hoạt động' : 'Nghỉ học'}</span>
                                </div>
                                <div class="col-actions">
                                    <button class="btn btn-sm btn-primary" onclick="viewStudentDetails(${student.id})" title="Xem chi tiết">
                                        <i class="fas fa-eye"></i>
                                    </button>
                                    <button class="btn btn-sm btn-success" onclick="editStudentDetails(${student.id})" title="Chỉnh sửa">
                                        <i class="fas fa-edit"></i>
                                    </button>
                                    <button class="btn btn-sm btn-danger" onclick="removeStudent(${student.id})" title="Xóa">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                `;
            }
            
            showNotification(`Đã tải dữ liệu học sinh lớp ${classId}`, 'success');
        };
        
        window.loadClassAssignmentsData = function(classId) {
            console.log('loadClassAssignmentsData called with:', classId);
            
            const assignmentsList = document.getElementById('assignmentsList');
            if (assignmentsList) {
                const assignments = [
                    { id: 1, title: 'Bài tập chương 2 - Phương trình bậc hai', dueDate: '15/10/2025', status: 'active', submissions: 42, total: 45, type: 'homework' },
                    { id: 2, title: 'Kiểm tra 15 phút - Hệ phương trình', dueDate: '18/10/2025', status: 'upcoming', submissions: 0, total: 45, type: 'quiz' },
                    { id: 3, title: 'Bài tập về nhà - Bất phương trình', dueDate: '20/10/2025', status: 'upcoming', submissions: 0, total: 45, type: 'homework' },
                    { id: 4, title: 'Ôn tập chương 1', dueDate: '12/10/2025', status: 'completed', submissions: 45, total: 45, type: 'review' },
                    { id: 5, title: 'Bài tập nâng cao', dueDate: '25/10/2025', status: 'upcoming', submissions: 0, total: 45, type: 'advanced' }
                ];
                
                assignmentsList.innerHTML = `
                    <div class="assignments-header">
                        <h4>Danh sách bài tập (${assignments.length} bài tập)</h4>
                        <button class="btn btn-primary" onclick="addNewAssignment(${classId})">
                            <i class="fas fa-plus"></i> Thêm bài tập
                        </button>
                    </div>
                    <div class="assignments-grid">
                        ${assignments.map(assignment => `
                            <div class="assignment-card">
                                <div class="assignment-header">
                                    <h5>${assignment.title}</h5>
                                    <span class="assignment-type ${assignment.type}">${assignment.type === 'homework' ? 'Bài tập' : assignment.type === 'quiz' ? 'Kiểm tra' : assignment.type === 'review' ? 'Ôn tập' : 'Nâng cao'}</span>
                                </div>
                                <div class="assignment-body">
                                    <div class="assignment-meta">
                                        <p><i class="fas fa-calendar"></i> Hạn: ${assignment.dueDate}</p>
                                        <p><i class="fas fa-users"></i> ${assignment.submissions}/${assignment.total} học sinh</p>
                                    </div>
                                    <div class="assignment-progress">
                                        <div class="progress-bar">
                                            <div class="progress-fill" style="width: ${(assignment.submissions / assignment.total) * 100}%"></div>
                                        </div>
                                        <span class="progress-text">${Math.round((assignment.submissions / assignment.total) * 100)}%</span>
                                    </div>
                                    <div class="assignment-status ${assignment.status}">
                                        ${assignment.status === 'active' ? 'Đang mở' : assignment.status === 'completed' ? 'Đã hoàn thành' : 'Sắp mở'}
                                    </div>
                                </div>
                                <div class="assignment-actions">
                                    <button class="btn btn-sm btn-primary" onclick="viewAssignmentDetails(${assignment.id})" title="Xem chi tiết">
                                        <i class="fas fa-eye"></i>
                                    </button>
                                    <button class="btn btn-sm btn-success" onclick="editAssignment(${assignment.id})" title="Chỉnh sửa">
                                        <i class="fas fa-edit"></i>
                                    </button>
                                    <button class="btn btn-sm btn-info" onclick="gradeAssignment(${assignment.id})" title="Chấm điểm">
                                        <i class="fas fa-check"></i>
                                    </button>
                                    <button class="btn btn-sm btn-danger" onclick="deleteAssignment(${assignment.id})" title="Xóa">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                `;
            }
            
            showNotification(`Đã tải dữ liệu bài tập lớp ${classId}`, 'success');
        };
        
        window.loadTabData = function(tabName) {
            console.log('loadTabData called with:', tabName);
            showNotification(`Tải dữ liệu tab ${tabName}`, 'success');
        };
        
        // Add new student function
        window.addNewStudent = function(classId) {
            console.log('addNewStudent called with:', classId);
            
            const modal = document.createElement('div');
            modal.className = 'modal active';
            modal.innerHTML = `
                <div class="modal-content">
                    <div class="modal-header">
                        <h3>Thêm học sinh mới</h3>
                        <button class="modal-close" onclick="this.closest('.modal').remove()">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    <div class="modal-body">
                        <div class="form-group">
                            <label>Họ và tên:</label>
                            <input type="text" class="form-control" id="studentName" placeholder="Nhập họ tên học sinh">
                        </div>
                        <div class="form-group">
                            <label>Email:</label>
                            <input type="email" class="form-control" id="studentEmail" placeholder="Nhập email học sinh">
                        </div>
                        <div class="form-group">
                            <label>Số điện thoại:</label>
                            <input type="tel" class="form-control" id="studentPhone" placeholder="Nhập số điện thoại">
                        </div>
                        <div class="form-group">
                            <label>Ngày sinh:</label>
                            <input type="date" class="form-control" id="studentBirthday">
                        </div>
                        <div class="form-group">
                            <label>Ghi chú:</label>
                            <textarea class="form-control" id="studentNotes" rows="3" placeholder="Ghi chú về học sinh"></textarea>
                        </div>
                        <div class="form-actions">
                            <button class="btn btn-primary" onclick="saveNewStudent(${classId})">
                                <i class="fas fa-save"></i> Thêm học sinh
                            </button>
                            <button class="btn btn-secondary" onclick="this.closest('.modal').remove()">
                                <i class="fas fa-times"></i> Hủy
                            </button>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            showNotification(`Thêm học sinh mới vào lớp ${classId}`, 'info');
        };
        
        window.saveNewStudent = function(classId) {
            const name = document.getElementById('studentName').value;
            const email = document.getElementById('studentEmail').value;
            const phone = document.getElementById('studentPhone').value;
            const birthday = document.getElementById('studentBirthday').value;
            const notes = document.getElementById('studentNotes').value;
            
            if (!name || !email) {
                showNotification('Vui lòng điền đầy đủ thông tin bắt buộc!', 'error');
                return;
            }
            
            showNotification(`Đã thêm học sinh ${name} vào lớp ${classId}!`, 'success');
            
            // Close modal
            const modal = document.querySelector('.modal.active');
            if (modal) {
                modal.remove();
            }
            
            // Refresh student list
            loadClassStudentsData(classId);
        };
        
        // Add new assignment function
        window.addNewAssignment = function(classId) {
            console.log('addNewAssignment called with:', classId);
            
            const modal = document.createElement('div');
            modal.className = 'modal active';
            modal.innerHTML = `
                <div class="modal-content">
                    <div class="modal-header">
                        <h3>Thêm bài tập mới</h3>
                        <button class="modal-close" onclick="this.closest('.modal').remove()">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    <div class="modal-body">
                        <div class="form-group">
                            <label>Tiêu đề bài tập:</label>
                            <input type="text" class="form-control" id="assignmentTitle" placeholder="Nhập tiêu đề bài tập">
                        </div>
                        <div class="form-group">
                            <label>Loại bài tập:</label>
                            <select class="form-control" id="assignmentType">
                                <option value="homework">Bài tập về nhà</option>
                                <option value="quiz">Kiểm tra</option>
                                <option value="review">Ôn tập</option>
                                <option value="advanced">Nâng cao</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Hạn nộp:</label>
                            <input type="datetime-local" class="form-control" id="assignmentDue">
                        </div>
                        <div class="form-group">
                            <label>Thời gian làm bài (phút):</label>
                            <input type="number" class="form-control" id="assignmentDuration" placeholder="60" min="1">
                        </div>
                        <div class="form-group">
                            <label>Mô tả bài tập:</label>
                            <textarea class="form-control" id="assignmentDescription" rows="4" placeholder="Mô tả chi tiết bài tập"></textarea>
                        </div>
                        <div class="form-group">
                            <label>Điểm tối đa:</label>
                            <input type="number" class="form-control" id="assignmentMaxScore" placeholder="10" min="1" max="100">
                        </div>
                        <div class="form-actions">
                            <button class="btn btn-primary" onclick="saveNewAssignment(${classId})">
                                <i class="fas fa-save"></i> Tạo bài tập
                            </button>
                            <button class="btn btn-secondary" onclick="this.closest('.modal').remove()">
                                <i class="fas fa-times"></i> Hủy
                            </button>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            showNotification(`Tạo bài tập mới cho lớp ${classId}`, 'info');
        };
        
        window.saveNewAssignment = function(classId) {
            const title = document.getElementById('assignmentTitle').value;
            const type = document.getElementById('assignmentType').value;
            const due = document.getElementById('assignmentDue').value;
            const duration = document.getElementById('assignmentDuration').value;
            const description = document.getElementById('assignmentDescription').value;
            const maxScore = document.getElementById('assignmentMaxScore').value;
            
            if (!title || !due) {
                showNotification('Vui lòng điền đầy đủ thông tin bắt buộc!', 'error');
                return;
            }
            
            showNotification(`Đã tạo bài tập "${title}" cho lớp ${classId}!`, 'success');
            
            // Close modal
            const modal = document.querySelector('.modal.active');
            if (modal) {
                modal.remove();
            }
            
            // Refresh assignment list
            loadClassAssignmentsData(classId);
        };
        
        // View reply history function
        window.viewReplyHistory = function(messageId) {
            console.log('viewReplyHistory called with:', messageId);
            
            const modal = document.createElement('div');
            modal.className = 'modal active';
            modal.innerHTML = `
                <div class="modal-content">
                    <div class="modal-header">
                        <h3>Lịch sử trả lời tin nhắn</h3>
                        <button class="modal-close" onclick="this.closest('.modal').remove()">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    <div class="modal-body">
                        <div class="reply-history">
                            <div class="original-message">
                                <h4>Tin nhắn gốc:</h4>
                                <div class="message-original">
                                    <div class="message-sender">Nguyễn Văn An (10A1)</div>
                                    <div class="message-time">2 giờ trước</div>
                                    <div class="message-content">
                                        <p>Thưa thầy/cô, em có thắc mắc về bài tập số 3 trang 45. Em không hiểu cách giải phương trình bậc hai này.</p>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="reply-thread">
                                <h4>Lịch sử trả lời:</h4>
                                <div class="reply-item">
                                    <div class="reply-header">
                                        <div class="reply-sender">Thầy/cô</div>
                                        <div class="reply-time">1 giờ trước</div>
                                    </div>
                                    <div class="reply-content">
                                        <p>Chào em, cảm ơn em đã hỏi về bài tập. Để giải phương trình bậc hai, em cần:</p>
                                        <p>1. Đưa phương trình về dạng ax² + bx + c = 0</p>
                                        <p>2. Tính delta = b² - 4ac</p>
                                        <p>3. Nếu delta > 0: có 2 nghiệm phân biệt</p>
                                        <p>Em có thể làm theo các bước trên. Nếu còn thắc mắc, em cứ hỏi thêm nhé!</p>
                                    </div>
                                </div>
                                
                                <div class="reply-item">
                                    <div class="reply-header">
                                        <div class="reply-sender">Nguyễn Văn An (10A1)</div>
                                        <div class="reply-time">30 phút trước</div>
                                    </div>
                                    <div class="reply-content">
                                        <p>Cảm ơn thầy/cô đã giải thích chi tiết! Em đã hiểu rồi ạ. Em sẽ làm bài tập theo hướng dẫn của thầy/cô.</p>
                                    </div>
                                </div>
                                
                                <div class="reply-item">
                                    <div class="reply-header">
                                        <div class="reply-sender">Thầy/cô</div>
                                        <div class="reply-time">15 phút trước</div>
                                    </div>
                                    <div class="reply-content">
                                        <p>Rất tốt! Nếu em gặp khó khăn gì khác, cứ hỏi thầy/cô nhé. Chúc em học tốt!</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            showNotification(`Đang hiển thị lịch sử trả lời tin nhắn ${messageId}`, 'info');
        };
        
        window.loadManagementTabData = function(tabName) {
            console.log('loadManagementTabData called with:', tabName);
            showNotification(`Tải dữ liệu tab quản lý ${tabName}`, 'success');
        };
        
        window.showManagementTab = function(tabName) {
            console.log('showManagementTab called with:', tabName);
            
            // Remove active class from all tabs
            const tabs = document.querySelectorAll('.management-tabs .tab-btn');
            tabs.forEach(tab => tab.classList.remove('active'));
            
            // Add active class to clicked tab
            const clickedTab = event.target.closest('.tab-btn');
            if (clickedTab) {
                clickedTab.classList.add('active');
            }
            
            // Show corresponding content
            const contents = document.querySelectorAll('.tab-content');
            contents.forEach(content => content.classList.remove('active'));
            
            const targetContent = document.getElementById(tabName + 'Tab');
            if (targetContent) {
                targetContent.classList.add('active');
            }
            
            // Load data for the tab
            if (tabName === 'attendance') {
                loadAttendanceData(1); // Assuming classId 1 for demo
            } else if (tabName === 'grading') {
                loadGradingData(1); // Assuming classId 1 for demo
            } else if (tabName === 'evaluation') {
                loadEvaluationData(1); // Assuming classId 1 for demo
            }
            
            showNotification(`Đã chuyển sang tab ${tabName}`, 'info');
        };
        
        window.loadAttendanceData = function(classId) {
            console.log('loadAttendanceData called with:', classId);
            
            const attendanceContainer = document.getElementById('attendanceList');
            console.log('attendanceContainer found:', attendanceContainer);
            if (attendanceContainer) {
                // Dữ liệu điểm danh cho các lớp khác nhau
                let students = [];
                let className = '';
                
                switch(classId) {
                    case 1:
                        className = 'Toán 10A1';
                        students = [
                            { id: 1, name: 'Nguyễn Văn An', studentId: 'HS001', status: 'present', time: '08:00', note: '' },
                            { id: 2, name: 'Trần Thị Bình', studentId: 'HS002', status: 'present', time: '08:02', note: '' },
                            { id: 3, name: 'Lê Văn Cường', studentId: 'HS003', status: 'absent', time: '', note: 'Nghỉ ốm' },
                            { id: 4, name: 'Phạm Thị Dung', studentId: 'HS004', status: 'present', time: '08:01', note: '' },
                            { id: 5, name: 'Hoàng Văn Em', studentId: 'HS005', status: 'late', time: '08:15', note: 'Xe hỏng' },
                            { id: 6, name: 'Vũ Thị Phương', studentId: 'HS006', status: 'present', time: '08:00', note: '' },
                            { id: 7, name: 'Đặng Văn Giang', studentId: 'HS007', status: 'present', time: '08:03', note: '' },
                            { id: 8, name: 'Bùi Thị Hoa', studentId: 'HS008', status: 'absent', time: '', note: 'Có việc gia đình' },
                            { id: 9, name: 'Ngô Văn Ích', studentId: 'HS009', status: 'present', time: '08:00', note: '' },
                            { id: 10, name: 'Đinh Thị Kim', studentId: 'HS010', status: 'present', time: '08:01', note: '' }
                        ];
                        break;
                    case 2:
                        className = 'Toán 11B2';
                        students = [
                            { id: 1, name: 'Nguyễn Văn An', studentId: 'HS001', status: 'present', time: '08:00', note: '' },
                            { id: 2, name: 'Trần Thị Bình', studentId: 'HS002', status: 'present', time: '08:02', note: '' },
                            { id: 3, name: 'Lê Văn Cường', studentId: 'HS003', status: 'absent', time: '', note: 'Nghỉ ốm' },
                            { id: 4, name: 'Phạm Thị Dung', studentId: 'HS004', status: 'present', time: '08:01', note: '' },
                            { id: 5, name: 'Hoàng Văn Em', studentId: 'HS005', status: 'late', time: '08:15', note: 'Xe hỏng' },
                            { id: 6, name: 'Vũ Thị Phương', studentId: 'HS006', status: 'present', time: '08:00', note: '' },
                            { id: 7, name: 'Đặng Văn Giang', studentId: 'HS007', status: 'present', time: '08:03', note: '' },
                            { id: 8, name: 'Bùi Thị Hoa', studentId: 'HS008', status: 'absent', time: '', note: 'Có việc gia đình' },
                            { id: 9, name: 'Ngô Văn Ích', studentId: 'HS009', status: 'present', time: '08:00', note: '' },
                            { id: 10, name: 'Đinh Thị Kim', studentId: 'HS010', status: 'present', time: '08:01', note: '' },
                            { id: 11, name: 'Lý Văn Long', studentId: 'HS011', status: 'present', time: '08:02', note: '' },
                            { id: 12, name: 'Mai Thị Mỹ', studentId: 'HS012', status: 'present', time: '08:01', note: '' },
                            { id: 13, name: 'Ninh Văn Nam', studentId: 'HS013', status: 'late', time: '08:20', note: 'Tắc đường' },
                            { id: 14, name: 'Ông Thị Oanh', studentId: 'HS014', status: 'present', time: '08:00', note: '' },
                            { id: 15, name: 'Phan Văn Phúc', studentId: 'HS015', status: 'present', time: '08:03', note: '' },
                            { id: 16, name: 'Quách Thị Quỳnh', studentId: 'HS016', status: 'present', time: '08:01', note: '' },
                            { id: 17, name: 'Rồng Văn Sơn', studentId: 'HS017', status: 'absent', time: '', note: 'Nghỉ có phép' },
                            { id: 18, name: 'Sử Thị Tâm', studentId: 'HS018', status: 'present', time: '08:02', note: '' },
                            { id: 19, name: 'Tôn Văn Uy', studentId: 'HS019', status: 'present', time: '08:00', note: '' },
                            { id: 20, name: 'Uông Thị Vân', studentId: 'HS020', status: 'late', time: '08:18', note: 'Đi muộn' }
                        ];
                        break;
                    case 3:
                        className = 'Toán 12C1';
                        students = [
                            { id: 1, name: 'Võ Văn Anh', studentId: 'HS001', status: 'present', time: '08:00', note: '' },
                            { id: 2, name: 'Lý Thị Bảo', studentId: 'HS002', status: 'present', time: '08:01', note: '' },
                            { id: 3, name: 'Đỗ Văn Cường', studentId: 'HS003', status: 'present', time: '08:00', note: '' },
                            { id: 4, name: 'Bùi Thị Dung', studentId: 'HS004', status: 'late', time: '08:12', note: 'Đi muộn' },
                            { id: 5, name: 'Hồ Văn Em', studentId: 'HS005', status: 'present', time: '08:02', note: '' },
                            { id: 6, name: 'Phạm Thị Phương', studentId: 'HS006', status: 'absent', time: '', note: 'Nghỉ ốm' },
                            { id: 7, name: 'Vương Văn Giang', studentId: 'HS007', status: 'present', time: '08:01', note: '' },
                            { id: 8, name: 'Tô Thị Hoa', studentId: 'HS008', status: 'present', time: '08:00', note: '' },
                            { id: 9, name: 'Nguyễn Văn Ích', studentId: 'HS009', status: 'late', time: '08:16', note: 'Tắc đường' },
                            { id: 10, name: 'Trần Thị Kim', studentId: 'HS010', status: 'present', time: '08:01', note: '' },
                            { id: 11, name: 'Lê Văn Long', studentId: 'HS011', status: 'present', time: '08:00', note: '' },
                            { id: 12, name: 'Hoàng Thị Mỹ', studentId: 'HS012', status: 'present', time: '08:02', note: '' },
                            { id: 13, name: 'Phan Văn Nam', studentId: 'HS013', status: 'absent', time: '', note: 'Có việc gia đình' },
                            { id: 14, name: 'Đặng Thị Oanh', studentId: 'HS014', status: 'present', time: '08:01', note: '' },
                            { id: 15, name: 'Bùi Văn Phúc', studentId: 'HS015', status: 'present', time: '08:00', note: '' }
                        ];
                        break;
                    default:
                        className = 'Toán 10A1';
                        students = [
                            { id: 1, name: 'Nguyễn Văn An', studentId: 'HS001', status: 'present', time: '08:00', note: '' },
                            { id: 2, name: 'Trần Thị Bình', studentId: 'HS002', status: 'present', time: '08:02', note: '' },
                            { id: 3, name: 'Lê Văn Cường', studentId: 'HS003', status: 'absent', time: '', note: 'Nghỉ ốm' }
                        ];
                        break;
                }
                
                const presentCount = students.filter(s => s.status === 'present').length;
                const absentCount = students.filter(s => s.status === 'absent').length;
                const lateCount = students.filter(s => s.status === 'late').length;
                const totalCount = students.length;
                
                const html = `
                    <div class="attendance-header">
                        <h3>Điểm danh lớp ${className} - ${new Date().toLocaleDateString('vi-VN')}</h3>
                        <div class="attendance-stats">
                            <div class="stat-item">
                                <span class="stat-number">${presentCount}</span>
                                <span class="stat-label">Có mặt</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-number">${absentCount}</span>
                                <span class="stat-label">Vắng mặt</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-number">${lateCount}</span>
                                <span class="stat-label">Đi muộn</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-number">${totalCount}</span>
                                <span class="stat-label">Tổng số</span>
                            </div>
                        </div>
                        <div class="attendance-actions">
                            <button class="btn btn-success" onclick="markAllPresent(${classId})">
                                <i class="fas fa-check"></i> Điểm danh tất cả
                            </button>
                            <button class="btn btn-danger" onclick="markAllAbsent(${classId})">
                                <i class="fas fa-times"></i> Đánh dấu vắng tất cả
                            </button>
                            <button class="btn btn-info" onclick="exportAttendance(${classId})">
                                <i class="fas fa-download"></i> Xuất báo cáo
                            </button>
                        </div>
                    </div>
                    
                    <div class="attendance-list">
                        <div class="attendance-table">
                            <div class="table-header">
                                <div class="col-checkbox">Chọn</div>
                                <div class="col-student">Học sinh</div>
                                <div class="col-status">Trạng thái</div>
                                <div class="col-time">Thời gian</div>
                                <div class="col-note">Ghi chú</div>
                                <div class="col-actions">Hành động</div>
                            </div>
                            ${students.map(student => `
                                <div class="table-row">
                                    <div class="col-checkbox">
                                        <input type="checkbox" class="student-checkbox" data-student-id="${student.id}">
                                    </div>
                                    <div class="col-student">
                                        <div class="student-info">
                                            <div class="student-name">${student.name}</div>
                                            <div class="student-id">${student.studentId}</div>
                                        </div>
                                    </div>
                                    <div class="col-status">
                                        <span class="status-badge ${student.status}">
                                            ${student.status === 'present' ? 'Có mặt' : student.status === 'absent' ? 'Vắng mặt' : 'Đi muộn'}
                                        </span>
                                    </div>
                                    <div class="col-time">
                                        ${student.time || '-'}
                                    </div>
                                    <div class="col-note">
                                        <input type="text" class="note-input" value="${student.note}" placeholder="Ghi chú...">
                                    </div>
                                    <div class="col-actions">
                                        <button class="btn btn-sm btn-success" onclick="toggleAttendance(${student.id}, 'present')" title="Có mặt">
                                            <i class="fas fa-check"></i>
                                        </button>
                                        <button class="btn btn-sm btn-danger" onclick="toggleAttendance(${student.id}, 'absent')" title="Vắng mặt">
                                            <i class="fas fa-times"></i>
                                        </button>
                                        <button class="btn btn-sm btn-warning" onclick="toggleAttendance(${student.id}, 'late')" title="Đi muộn">
                                            <i class="fas fa-clock"></i>
                                        </button>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                `;
                
                console.log('Setting attendance HTML:', html.substring(0, 200) + '...');
                attendanceContainer.innerHTML = html;
                console.log('Attendance data loaded successfully');
                
                showNotification(`Đã tải dữ liệu điểm danh lớp ${classId}!`, 'success');
            } else {
                console.error('attendanceContainer not found!');
                showNotification('Lỗi: Không tìm thấy container điểm danh!', 'error');
            }
        };
        
        window.loadGradingData = function(classId) {
            console.log('loadGradingData called with:', classId);
            
            const gradingContainer = document.getElementById('gradingList');
            if (gradingContainer) {
                let assignments = [];
                let students = [];
                let className = '';
                
                switch(classId) {
                    case 1:
                        className = 'Toán 10A1';
                        assignments = [
                            { id: 1, title: 'Bài tập chương 1 - Hàm số bậc nhất', dueDate: '15/10/2025', status: 'active', totalStudents: 10, gradedStudents: 7 },
                            { id: 2, title: 'Kiểm tra 15 phút - Đồ thị hàm số', dueDate: '18/10/2025', status: 'upcoming', totalStudents: 10, gradedStudents: 0 }
                        ];
                        students = [
                            { id: 1, name: 'Nguyễn Văn An', studentId: 'HS001', grade: 8.5, status: 'graded' },
                            { id: 2, name: 'Trần Thị Bình', studentId: 'HS002', grade: 7.0, status: 'graded' },
                            { id: 3, name: 'Lê Văn Cường', studentId: 'HS003', grade: 0, status: 'not_submitted' },
                            { id: 4, name: 'Phạm Thị Dung', studentId: 'HS004', grade: 9.0, status: 'graded' },
                            { id: 5, name: 'Hoàng Văn Em', studentId: 'HS005', grade: 6.5, status: 'graded' },
                            { id: 6, name: 'Vũ Thị Phương', studentId: 'HS006', grade: 0, status: 'not_submitted' },
                            { id: 7, name: 'Đặng Văn Giang', studentId: 'HS007', grade: 8.8, status: 'graded' },
                            { id: 8, name: 'Bùi Thị Hoa', studentId: 'HS008', grade: 0, status: 'not_submitted' },
                            { id: 9, name: 'Ngô Văn Ích', studentId: 'HS009', grade: 7.5, status: 'graded' },
                            { id: 10, name: 'Đinh Thị Kim', studentId: 'HS010', grade: 8.0, status: 'graded' }
                        ];
                        break;
                    case 2:
                        className = 'Toán 11B2';
                        assignments = [
                            { id: 1, title: 'Bài tập chương 2 - Phương trình bậc hai', dueDate: '15/10/2025', status: 'active', totalStudents: 20, gradedStudents: 15 },
                            { id: 2, title: 'Kiểm tra 15 phút - Hệ phương trình', dueDate: '18/10/2025', status: 'upcoming', totalStudents: 20, gradedStudents: 0 },
                            { id: 3, title: 'Bài tập về nhà - Bất phương trình', dueDate: '20/10/2025', status: 'upcoming', totalStudents: 20, gradedStudents: 0 }
                        ];
                        students = [
                            { id: 1, name: 'Nguyễn Văn An', studentId: 'HS001', grade: 8.5, status: 'graded' },
                            { id: 2, name: 'Trần Thị Bình', studentId: 'HS002', grade: 7.0, status: 'graded' },
                            { id: 3, name: 'Lê Văn Cường', studentId: 'HS003', grade: 0, status: 'not_submitted' },
                            { id: 4, name: 'Phạm Thị Dung', studentId: 'HS004', grade: 9.0, status: 'graded' },
                            { id: 5, name: 'Hoàng Văn Em', studentId: 'HS005', grade: 6.5, status: 'graded' },
                            { id: 6, name: 'Vũ Thị Phương', studentId: 'HS006', grade: 0, status: 'not_submitted' },
                            { id: 7, name: 'Đặng Văn Giang', studentId: 'HS007', grade: 8.8, status: 'graded' },
                            { id: 8, name: 'Bùi Thị Hoa', studentId: 'HS008', grade: 0, status: 'not_submitted' },
                            { id: 9, name: 'Ngô Văn Ích', studentId: 'HS009', grade: 7.5, status: 'graded' },
                            { id: 10, name: 'Đinh Thị Kim', studentId: 'HS010', grade: 8.0, status: 'graded' },
                            { id: 11, name: 'Lý Văn Long', studentId: 'HS011', grade: 8.2, status: 'graded' },
                            { id: 12, name: 'Mai Thị Mỹ', studentId: 'HS012', grade: 0, status: 'not_submitted' },
                            { id: 13, name: 'Ninh Văn Nam', studentId: 'HS013', grade: 7.8, status: 'graded' },
                            { id: 14, name: 'Ông Thị Oanh', studentId: 'HS014', grade: 9.2, status: 'graded' },
                            { id: 15, name: 'Phan Văn Phúc', studentId: 'HS015', grade: 0, status: 'not_submitted' }
                        ];
                        break;
                    case 3:
                        className = 'Toán 12C1';
                        assignments = [
                            { id: 1, title: 'Bài tập chương 3 - Tích phân', dueDate: '15/10/2025', status: 'active', totalStudents: 15, gradedStudents: 12 },
                            { id: 2, title: 'Kiểm tra 15 phút - Nguyên hàm', dueDate: '18/10/2025', status: 'upcoming', totalStudents: 15, gradedStudents: 0 }
                        ];
                        students = [
                            { id: 1, name: 'Võ Văn Anh', studentId: 'HS001', grade: 8.7, status: 'graded' },
                            { id: 2, name: 'Lý Thị Bảo', studentId: 'HS002', grade: 7.5, status: 'graded' },
                            { id: 3, name: 'Đỗ Văn Cường', studentId: 'HS003', grade: 0, status: 'not_submitted' },
                            { id: 4, name: 'Bùi Thị Dung', studentId: 'HS004', grade: 9.1, status: 'graded' },
                            { id: 5, name: 'Hồ Văn Em', studentId: 'HS005', grade: 8.3, status: 'graded' },
                            { id: 6, name: 'Phạm Thị Phương', studentId: 'HS006', grade: 0, status: 'not_submitted' },
                            { id: 7, name: 'Vương Văn Giang', studentId: 'HS007', grade: 8.9, status: 'graded' },
                            { id: 8, name: 'Tô Thị Hoa', studentId: 'HS008', grade: 0, status: 'not_submitted' },
                            { id: 9, name: 'Nguyễn Văn Ích', studentId: 'HS009', grade: 7.9, status: 'graded' },
                            { id: 10, name: 'Trần Thị Kim', studentId: 'HS010', grade: 8.4, status: 'graded' }
                        ];
                        break;
                    default:
                        className = 'Toán 10A1';
                        assignments = [
                            { id: 1, title: 'Bài tập cơ bản', dueDate: '15/10/2025', status: 'active', totalStudents: 3, gradedStudents: 2 }
                        ];
                        students = [
                            { id: 1, name: 'Nguyễn Văn An', studentId: 'HS001', grade: 8.5, status: 'graded' },
                            { id: 2, name: 'Trần Thị Bình', studentId: 'HS002', grade: 7.0, status: 'graded' },
                            { id: 3, name: 'Lê Văn Cường', studentId: 'HS003', grade: 0, status: 'not_submitted' }
                        ];
                        break;
                }
                
                gradingContainer.innerHTML = `
                    <div class="grading-header">
                        <h3>Chấm điểm lớp ${className} - ${new Date().toLocaleDateString('vi-VN')}</h3>
                        <div class="grading-stats">
                            <div class="stat-item">
                                <span class="stat-number">${assignments.length}</span>
                                <span class="stat-label">Bài tập</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-number">${students.filter(s => s.status === 'graded').length}</span>
                                <span class="stat-label">Đã chấm</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-number">${students.filter(s => s.status === 'not_submitted').length}</span>
                                <span class="stat-label">Chưa nộp</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-number">${(students.filter(s => s.status === 'graded').reduce((sum, s) => sum + s.grade, 0) / students.filter(s => s.status === 'graded').length).toFixed(1)}</span>
                                <span class="stat-label">Điểm TB</span>
                            </div>
                        </div>
                        <div class="grading-actions">
                            <button class="btn btn-primary" onclick="bulkGrading(${classId})">
                                <i class="fas fa-check-double"></i> Chấm điểm hàng loạt
                            </button>
                            <button class="btn btn-success" onclick="exportGrades(${classId})">
                                <i class="fas fa-download"></i> Xuất báo cáo
                            </button>
                        </div>
                    </div>
                    
                    <div class="grading-content">
                        <div class="assignments-section">
                            <h4>Danh sách bài tập</h4>
                            <div class="assignments-list">
                                ${assignments.map(assignment => `
                                    <div class="assignment-item">
                                        <div class="assignment-info">
                                            <h5>${assignment.title}</h5>
                                            <p>Hạn nộp: ${assignment.dueDate}</p>
                                        </div>
                                        <div class="assignment-progress">
                                            <div class="progress-bar">
                                                <div class="progress-fill" style="width: ${(assignment.gradedStudents / assignment.totalStudents) * 100}%"></div>
                                            </div>
                                            <span class="progress-text">${assignment.gradedStudents}/${assignment.totalStudents}</span>
                                        </div>
                                        <div class="assignment-status ${assignment.status}">
                                            ${assignment.status === 'active' ? 'Đang mở' : assignment.status === 'upcoming' ? 'Sắp mở' : 'Đã đóng'}
                                        </div>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                        
                        <div class="students-section">
                            <h4>Danh sách học sinh</h4>
                            <div class="students-table">
                                <div class="table-header">
                                    <div class="col-student">Học sinh</div>
                                    <div class="col-grade">Điểm</div>
                                    <div class="col-status">Trạng thái</div>
                                    <div class="col-actions">Hành động</div>
                                </div>
                                ${students.map(student => `
                                    <div class="table-row">
                                        <div class="col-student">
                                            <div class="student-info">
                                                <div class="student-name">${student.name}</div>
                                                <div class="student-id">${student.studentId}</div>
                                            </div>
                                        </div>
                                        <div class="col-grade">
                                            <input type="number" class="grade-input" value="${student.grade}" min="0" max="10" step="0.1" 
                                                   ${student.status === 'not_submitted' ? 'disabled' : ''}>
                                        </div>
                                        <div class="col-status">
                                            <span class="status-badge ${student.status}">
                                                ${student.status === 'graded' ? 'Đã chấm' : 'Chưa nộp'}
                                            </span>
                                        </div>
                                        <div class="col-actions">
                                            <button class="btn btn-sm btn-primary" onclick="gradeStudent(${student.id})" 
                                                    ${student.status === 'not_submitted' ? 'disabled' : ''}>
                                                <i class="fas fa-check"></i>
                                            </button>
                                            <button class="btn btn-sm btn-info" onclick="viewSubmission(${student.id})">
                                                <i class="fas fa-eye"></i>
                                            </button>
                                        </div>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    </div>
                `;
            }
            
            showNotification(`Đã tải dữ liệu chấm điểm lớp ${classId}!`, 'success');
        };
        
        window.loadEvaluationData = function(classId) {
            console.log('loadEvaluationData called with:', classId);
            
            const evaluationContainer = document.getElementById('evaluationList');
            if (evaluationContainer) {
                let evaluations = [];
                let students = [];
                let className = '';
                
                switch(classId) {
                    case 1:
                        className = 'Toán 10A1';
                        evaluations = [
                            { id: 1, studentName: 'Nguyễn Văn An', studentId: 'HS001', date: '10/10/2025', type: 'positive', content: 'Học tập tích cực, tham gia xây dựng bài tốt', teacher: 'Thầy A' },
                            { id: 2, studentName: 'Trần Thị Bình', studentId: 'HS002', date: '09/10/2025', type: 'improvement', content: 'Cần cải thiện kỹ năng giải bài tập', teacher: 'Thầy A' },
                            { id: 3, studentName: 'Lê Văn Cường', studentId: 'HS003', date: '08/10/2025', type: 'warning', content: 'Thiếu tập trung trong giờ học', teacher: 'Thầy A' }
                        ];
                        students = [
                            { id: 1, name: 'Nguyễn Văn An', studentId: 'HS001', totalEvaluations: 3, lastEvaluation: '10/10/2025' },
                            { id: 2, name: 'Trần Thị Bình', studentId: 'HS002', totalEvaluations: 2, lastEvaluation: '09/10/2025' },
                            { id: 3, name: 'Lê Văn Cường', studentId: 'HS003', totalEvaluations: 1, lastEvaluation: '08/10/2025' },
                            { id: 4, name: 'Phạm Thị Dung', studentId: 'HS004', totalEvaluations: 4, lastEvaluation: '11/10/2025' },
                            { id: 5, name: 'Hoàng Văn Em', studentId: 'HS005', totalEvaluations: 2, lastEvaluation: '07/10/2025' },
                            { id: 6, name: 'Vũ Thị Phương', studentId: 'HS006', totalEvaluations: 0, lastEvaluation: '-' },
                            { id: 7, name: 'Đặng Văn Giang', studentId: 'HS007', totalEvaluations: 1, lastEvaluation: '05/10/2025' },
                            { id: 8, name: 'Bùi Thị Hoa', studentId: 'HS008', totalEvaluations: 0, lastEvaluation: '-' },
                            { id: 9, name: 'Ngô Văn Ích', studentId: 'HS009', totalEvaluations: 2, lastEvaluation: '06/10/2025' },
                            { id: 10, name: 'Đinh Thị Kim', studentId: 'HS010', totalEvaluations: 1, lastEvaluation: '04/10/2025' }
                        ];
                        break;
                    case 2:
                        className = 'Toán 11B2';
                        evaluations = [
                            { id: 1, studentName: 'Nguyễn Văn An', studentId: 'HS001', date: '10/10/2025', type: 'positive', content: 'Học tập tích cực, tham gia xây dựng bài tốt', teacher: 'Thầy A' },
                            { id: 2, studentName: 'Trần Thị Bình', studentId: 'HS002', date: '09/10/2025', type: 'improvement', content: 'Cần cải thiện kỹ năng giải bài tập', teacher: 'Thầy A' },
                            { id: 3, studentName: 'Lê Văn Cường', studentId: 'HS003', date: '08/10/2025', type: 'warning', content: 'Thiếu tập trung trong giờ học', teacher: 'Thầy A' },
                            { id: 4, studentName: 'Phạm Thị Dung', studentId: 'HS004', date: '11/10/2025', type: 'positive', content: 'Kết quả học tập xuất sắc', teacher: 'Thầy A' },
                            { id: 5, studentName: 'Hoàng Văn Em', studentId: 'HS005', date: '07/10/2025', type: 'improvement', content: 'Cần chăm chỉ hơn trong việc làm bài tập', teacher: 'Thầy A' },
                            { id: 6, studentName: 'Vũ Thị Phương', studentId: 'HS006', date: '06/10/2025', type: 'positive', content: 'Tiến bộ rõ rệt trong học tập', teacher: 'Thầy A' }
                        ];
                        students = [
                            { id: 1, name: 'Nguyễn Văn An', studentId: 'HS001', totalEvaluations: 3, lastEvaluation: '10/10/2025' },
                            { id: 2, name: 'Trần Thị Bình', studentId: 'HS002', totalEvaluations: 2, lastEvaluation: '09/10/2025' },
                            { id: 3, name: 'Lê Văn Cường', studentId: 'HS003', totalEvaluations: 1, lastEvaluation: '08/10/2025' },
                            { id: 4, name: 'Phạm Thị Dung', studentId: 'HS004', totalEvaluations: 4, lastEvaluation: '11/10/2025' },
                            { id: 5, name: 'Hoàng Văn Em', studentId: 'HS005', totalEvaluations: 2, lastEvaluation: '07/10/2025' },
                            { id: 6, name: 'Vũ Thị Phương', studentId: 'HS006', totalEvaluations: 1, lastEvaluation: '06/10/2025' },
                            { id: 7, name: 'Đặng Văn Giang', studentId: 'HS007', totalEvaluations: 1, lastEvaluation: '05/10/2025' },
                            { id: 8, name: 'Bùi Thị Hoa', studentId: 'HS008', totalEvaluations: 0, lastEvaluation: '-' },
                            { id: 9, name: 'Ngô Văn Ích', studentId: 'HS009', totalEvaluations: 2, lastEvaluation: '06/10/2025' },
                            { id: 10, name: 'Đinh Thị Kim', studentId: 'HS010', totalEvaluations: 1, lastEvaluation: '04/10/2025' },
                            { id: 11, name: 'Lý Văn Long', studentId: 'HS011', totalEvaluations: 3, lastEvaluation: '09/10/2025' },
                            { id: 12, name: 'Mai Thị Mỹ', studentId: 'HS012', totalEvaluations: 0, lastEvaluation: '-' },
                            { id: 13, name: 'Ninh Văn Nam', studentId: 'HS013', totalEvaluations: 1, lastEvaluation: '08/10/2025' },
                            { id: 14, name: 'Ông Thị Oanh', studentId: 'HS014', totalEvaluations: 2, lastEvaluation: '07/10/2025' },
                            { id: 15, name: 'Phan Văn Phúc', studentId: 'HS015', totalEvaluations: 0, lastEvaluation: '-' }
                        ];
                        break;
                    case 3:
                        className = 'Toán 12C1';
                        evaluations = [
                            { id: 1, studentName: 'Võ Văn Anh', studentId: 'HS001', date: '10/10/2025', type: 'positive', content: 'Học sinh xuất sắc, có khả năng tư duy tốt', teacher: 'Thầy A' },
                            { id: 2, studentName: 'Lý Thị Bảo', studentId: 'HS002', date: '09/10/2025', type: 'improvement', content: 'Cần cải thiện kỹ năng tính toán', teacher: 'Thầy A' },
                            { id: 3, studentName: 'Đỗ Văn Cường', studentId: 'HS003', date: '08/10/2025', type: 'warning', content: 'Thiếu chuẩn bị bài trước khi đến lớp', teacher: 'Thầy A' }
                        ];
                        students = [
                            { id: 1, name: 'Võ Văn Anh', studentId: 'HS001', totalEvaluations: 3, lastEvaluation: '10/10/2025' },
                            { id: 2, name: 'Lý Thị Bảo', studentId: 'HS002', totalEvaluations: 2, lastEvaluation: '09/10/2025' },
                            { id: 3, name: 'Đỗ Văn Cường', studentId: 'HS003', totalEvaluations: 1, lastEvaluation: '08/10/2025' },
                            { id: 4, name: 'Bùi Thị Dung', studentId: 'HS004', totalEvaluations: 4, lastEvaluation: '11/10/2025' },
                            { id: 5, name: 'Hồ Văn Em', studentId: 'HS005', totalEvaluations: 2, lastEvaluation: '07/10/2025' },
                            { id: 6, name: 'Phạm Thị Phương', studentId: 'HS006', totalEvaluations: 0, lastEvaluation: '-' },
                            { id: 7, name: 'Vương Văn Giang', studentId: 'HS007', totalEvaluations: 1, lastEvaluation: '05/10/2025' },
                            { id: 8, name: 'Tô Thị Hoa', studentId: 'HS008', totalEvaluations: 0, lastEvaluation: '-' },
                            { id: 9, name: 'Nguyễn Văn Ích', studentId: 'HS009', totalEvaluations: 2, lastEvaluation: '06/10/2025' },
                            { id: 10, name: 'Trần Thị Kim', studentId: 'HS010', totalEvaluations: 1, lastEvaluation: '04/10/2025' }
                        ];
                        break;
                    default:
                        className = 'Toán 10A1';
                        evaluations = [
                            { id: 1, studentName: 'Nguyễn Văn An', studentId: 'HS001', date: '10/10/2025', type: 'positive', content: 'Học tập tích cực', teacher: 'Thầy A' }
                        ];
                        students = [
                            { id: 1, name: 'Nguyễn Văn An', studentId: 'HS001', totalEvaluations: 1, lastEvaluation: '10/10/2025' },
                            { id: 2, name: 'Trần Thị Bình', studentId: 'HS002', totalEvaluations: 0, lastEvaluation: '-' },
                            { id: 3, name: 'Lê Văn Cường', studentId: 'HS003', totalEvaluations: 0, lastEvaluation: '-' }
                        ];
                        break;
                }
                
                evaluationContainer.innerHTML = `
                    <div class="evaluation-header">
                        <h3>Đánh giá lớp ${className} - ${new Date().toLocaleDateString('vi-VN')}</h3>
                        <div class="evaluation-stats">
                            <div class="stat-item">
                                <span class="stat-number">${evaluations.length}</span>
                                <span class="stat-label">Đánh giá</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-number">${evaluations.filter(e => e.type === 'positive').length}</span>
                                <span class="stat-label">Tích cực</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-number">${evaluations.filter(e => e.type === 'improvement').length}</span>
                                <span class="stat-label">Cần cải thiện</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-number">${evaluations.filter(e => e.type === 'warning').length}</span>
                                <span class="stat-label">Cảnh báo</span>
                            </div>
                        </div>
                        <div class="evaluation-actions">
                            <button class="btn btn-primary" onclick="addEvaluation(${classId})">
                                <i class="fas fa-plus"></i> Thêm đánh giá
                            </button>
                            <button class="btn btn-success" onclick="exportEvaluations(${classId})">
                                <i class="fas fa-download"></i> Xuất báo cáo
                            </button>
                        </div>
                    </div>
                    
                    <div class="evaluation-content">
                        <div class="recent-evaluations">
                            <h4>Đánh giá gần đây</h4>
                            <div class="evaluations-list">
                                ${evaluations.map(evaluation => `
                                    <div class="evaluation-item ${evaluation.type}">
                                        <div class="evaluation-header">
                                            <div class="student-info">
                                                <div class="student-name">${evaluation.studentName}</div>
                                                <div class="student-id">${evaluation.studentId}</div>
                                            </div>
                                            <div class="evaluation-meta">
                                                <div class="evaluation-date">${evaluation.date}</div>
                                                <div class="evaluation-teacher">${evaluation.teacher}</div>
                                            </div>
                                        </div>
                                        <div class="evaluation-content">
                                            <p>${evaluation.content}</p>
                                        </div>
                                        <div class="evaluation-actions">
                                            <button class="btn btn-sm btn-primary" onclick="editEvaluation(${evaluation.id})">
                                                <i class="fas fa-edit"></i>
                                            </button>
                                            <button class="btn btn-sm btn-danger" onclick="deleteEvaluation(${evaluation.id})">
                                                <i class="fas fa-trash"></i>
                                            </button>
                                        </div>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                        
                        <div class="students-evaluation">
                            <h4>Danh sách học sinh</h4>
                            <div class="students-table">
                                <div class="table-header">
                                    <div class="col-student">Học sinh</div>
                                    <div class="col-evaluations">Số đánh giá</div>
                                    <div class="col-last">Lần cuối</div>
                                    <div class="col-actions">Hành động</div>
                                </div>
                                ${students.map(student => `
                                    <div class="table-row">
                                        <div class="col-student">
                                            <div class="student-info">
                                                <div class="student-name">${student.name}</div>
                                                <div class="student-id">${student.studentId}</div>
                                            </div>
                                        </div>
                                        <div class="col-evaluations">
                                            <span class="evaluation-count">${student.totalEvaluations}</span>
                                        </div>
                                        <div class="col-last">
                                            <span class="last-evaluation">${student.lastEvaluation}</span>
                                        </div>
                                        <div class="col-actions">
                                            <button class="btn btn-sm btn-primary" onclick="addStudentEvaluation(${student.id})">
                                                <i class="fas fa-plus"></i>
                                            </button>
                                            <button class="btn btn-sm btn-info" onclick="viewStudentEvaluations(${student.id})">
                                                <i class="fas fa-eye"></i>
                                            </button>
                                        </div>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    </div>
                `;
            }
            
            showNotification(`Đã tải dữ liệu đánh giá lớp ${classId}!`, 'success');
        };
        
        
        window.closeClassManagementModal = function() {
            const modal = document.getElementById('classManagementModal');
            if (modal) {
                modal.classList.remove('active');
                document.body.style.overflow = 'auto';
            }
        };
        
        window.showManagementTab = function(tabName) {
            console.log('showManagementTab called with:', tabName);
            
            // Remove active class from all tabs
            const tabButtons = document.querySelectorAll('.management-tabs .tab-btn');
            const tabContents = document.querySelectorAll('.tab-content');
            
            tabButtons.forEach(btn => btn.classList.remove('active'));
            tabContents.forEach(content => content.classList.remove('active'));
            
            // Add active class to selected tab
            const activeButton = document.querySelector(`[onclick="showManagementTab('${tabName}')"]`);
            const activeContent = document.getElementById(`${tabName}Tab`);
            
            if (activeButton) activeButton.classList.add('active');
            if (activeContent) activeContent.classList.add('active');
            
            showNotification(`Đã chuyển sang tab ${tabName}`, 'info');
        };
        
        
        window.toggleAttendance = function(studentId) {
            console.log('toggleAttendance called with:', studentId);
            const statusElement = event.target;
            const currentStatus = statusElement.textContent;
            
            let newStatus, newClass;
            if (currentStatus === 'Có mặt') {
                newStatus = 'Vắng mặt';
                newClass = 'absent';
            } else if (currentStatus === 'Vắng mặt') {
                newStatus = 'Muộn';
                newClass = 'late';
            } else {
                newStatus = 'Có mặt';
                newClass = 'present';
            }
            
            statusElement.textContent = newStatus;
            statusElement.className = `attendance-status ${newClass}`;
            
            // Update attendance statistics
            updateAttendanceStats();
            
            // Show success notification
            showNotification(`Đã cập nhật trạng thái học sinh ${studentId} thành: ${newStatus}`, 'success');
        };
        
        window.updateGrade = function(studentId, grade) {
            console.log('updateGrade called with:', studentId, grade);
            
            // Validate grade
            if (grade < 0 || grade > 10) {
                showNotification('Điểm số phải từ 0 đến 10', 'error');
                return;
            }
            
            // Update grade statistics
            updateGradeStats();
            
            // Show success notification
            showNotification(`Đã cập nhật điểm học sinh ${studentId} thành: ${grade}`, 'success');
        };
        
        window.markAllPresent = function() {
            console.log('markAllPresent called');
            const attendanceItems = document.querySelectorAll('.attendance-item');
            attendanceItems.forEach(item => {
                const statusElement = item.querySelector('.attendance-status');
                if (statusElement) {
                    statusElement.textContent = 'Có mặt';
                    statusElement.className = 'attendance-status present';
                }
            });
            updateAttendanceStats();
            showNotification('Đã điểm danh tất cả học sinh!', 'success');
        };
        
        window.markAllAbsent = function() {
            console.log('markAllAbsent called');
            const attendanceItems = document.querySelectorAll('.attendance-item');
            attendanceItems.forEach(item => {
                const statusElement = item.querySelector('.attendance-status');
                if (statusElement) {
                    statusElement.textContent = 'Vắng mặt';
                    statusElement.className = 'attendance-status absent';
                }
            });
            updateAttendanceStats();
            showNotification('Đã đánh dấu vắng tất cả học sinh!', 'info');
        };
        
        window.exportAttendance = function(classId) {
            console.log('exportAttendance called with:', classId);
            
            // Tạo dữ liệu CSV cho điểm danh
            const csvContent = `Lớp Toán 11B2 - Báo cáo điểm danh ${new Date().toLocaleDateString('vi-VN')}
STT,Họ và tên,Mã học sinh,Trạng thái,Thời gian,Ghi chú
1,Nguyễn Văn An,HS001,Có mặt,08:00,
2,Trần Thị Bình,HS002,Có mặt,08:02,
3,Lê Văn Cường,HS003,Vắng mặt,,Nghỉ ốm
4,Phạm Thị Dung,HS004,Có mặt,08:01,
5,Hoàng Văn Em,HS005,Đi muộn,08:15,Xe hỏng
6,Vũ Thị Phương,HS006,Có mặt,08:00,
7,Đặng Văn Giang,HS007,Có mặt,08:03,
8,Bùi Thị Hoa,HS008,Vắng mặt,,Có việc gia đình
9,Ngô Văn Ích,HS009,Có mặt,08:00,
10,Đinh Thị Kim,HS010,Có mặt,08:01,
11,Lý Văn Long,HS011,Có mặt,08:02,
12,Mai Thị Mỹ,HS012,Có mặt,08:01,
13,Ninh Văn Nam,HS013,Đi muộn,08:20,Tắc đường
14,Ông Thị Oanh,HS014,Có mặt,08:00,
15,Phan Văn Phúc,HS015,Có mặt,08:03,
16,Quách Thị Quỳnh,HS016,Có mặt,08:01,
17,Rồng Văn Sơn,HS017,Vắng mặt,,Nghỉ có phép
18,Sử Thị Tâm,HS018,Có mặt,08:02,
19,Tôn Văn Uy,HS019,Có mặt,08:00,
20,Uông Thị Vân,HS020,Đi muộn,08:18,Đi muộn

Tổng kết:
- Có mặt: 15 học sinh
- Vắng mặt: 3 học sinh  
- Đi muộn: 2 học sinh
- Tổng số: 20 học sinh
- Tỷ lệ có mặt: 75%`;

            // Tạo và tải file
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            link.setAttribute('href', url);
            link.setAttribute('download', `DiemDanh_Toan11B2_${new Date().toISOString().split('T')[0]}.csv`);
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            showNotification('Đã xuất báo cáo điểm danh thành công!', 'success');
        };
        
        window.addQuickGrade = function() {
            console.log('addQuickGrade called');
            const gradingList = document.getElementById('gradingList');
            if (gradingList) {
                const newGradeItem = document.createElement('div');
                newGradeItem.className = 'grading-item';
                newGradeItem.innerHTML = `
                    <div class="student-info">
                        <div class="student-avatar">HS</div>
                        <div class="student-details">
                            <div class="student-name">Học sinh mới</div>
                            <div class="student-email">hocsinh@email.com</div>
                        </div>
                    </div>
                    <input type="number" class="grade-input" value="0" min="0" max="10" step="0.1" onchange="updateGrade(999, this.value)">
                `;
                gradingList.appendChild(newGradeItem);
                showNotification('Đã thêm điểm nhanh!', 'success');
            }
        };
        
        window.bulkGrading = function() {
            console.log('bulkGrading called');
            const gradeInputs = document.querySelectorAll('.grade-input');
            let updatedCount = 0;
            
            gradeInputs.forEach(input => {
                if (input.value === '' || input.value === '0') {
                    input.value = '8.0';
                    updatedCount++;
                }
            });
            
            updateGradeStats();
            showNotification(`Đã chấm điểm hàng loạt cho ${updatedCount} học sinh!`, 'success');
        };
        
        window.addEvaluation = function() {
            console.log('addEvaluation called');
            const evaluationList = document.getElementById('evaluationList');
            if (evaluationList) {
                const newEvaluation = document.createElement('div');
                newEvaluation.className = 'evaluation-item';
                newEvaluation.innerHTML = `
                    <div class="evaluation-content">
                        <div class="evaluation-text">Đánh giá mới - Học sinh có tiến bộ tốt</div>
                        <div class="evaluation-date">${new Date().toLocaleDateString('vi-VN')}</div>
                    </div>
                    <div class="evaluation-actions">
                        <button class="btn btn-sm btn-primary" onclick="editEvaluation(999)">Sửa</button>
                        <button class="btn btn-sm btn-danger" onclick="deleteEvaluation(999)">Xóa</button>
                    </div>
                `;
                evaluationList.appendChild(newEvaluation);
                showNotification('Đã thêm đánh giá mới!', 'success');
            }
        };
        
        window.editEvaluation = function(evaluationId) {
            console.log('editEvaluation called with:', evaluationId);
            const newText = prompt('Nhập nội dung đánh giá mới:');
            if (newText) {
                const evaluationItem = event.target.closest('.evaluation-item');
                if (evaluationItem) {
                    const textElement = evaluationItem.querySelector('.evaluation-text');
                    if (textElement) {
                        textElement.textContent = newText;
                    }
                }
                showNotification('Đã cập nhật đánh giá!', 'success');
            }
        };
        
        window.deleteEvaluation = function(evaluationId) {
            console.log('deleteEvaluation called with:', evaluationId);
            if (confirm('Bạn có chắc muốn xóa đánh giá này?')) {
                const evaluationItem = event.target.closest('.evaluation-item');
                if (evaluationItem) {
                    evaluationItem.remove();
                    showNotification('Đã xóa đánh giá!', 'success');
                }
            }
        };
        
        window.exportEvaluations = function() {
            console.log('exportEvaluations called');
            const evaluationItems = document.querySelectorAll('.evaluation-item');
            let csvContent = 'Đánh giá học sinh - ' + new Date().toLocaleDateString('vi-VN') + '\n';
            csvContent += 'Nội dung,Ngày tạo\n';
            
            evaluationItems.forEach(item => {
                const text = item.querySelector('.evaluation-text')?.textContent || '';
                const date = item.querySelector('.evaluation-date')?.textContent || '';
                csvContent += `"${text}","${date}"\n`;
            });
            
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            link.setAttribute('href', url);
            link.setAttribute('download', `danh_gia_hoc_sinh_${new Date().toISOString().split('T')[0]}.csv`);
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            showNotification('Đã xuất đánh giá!', 'success');
        };
        
        window.viewSessionDetails = function(sessionId) {
            console.log('viewSessionDetails called with:', sessionId);
            
            // Create session details modal
            const modal = document.createElement('div');
            modal.className = 'modal active';
            modal.innerHTML = `
                <div class="modal-content">
                    <div class="modal-header">
                        <h3>Chi tiết buổi học ${sessionId}</h3>
                        <button class="modal-close" onclick="this.closest('.modal').remove()">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    <div class="modal-body">
                        <div class="session-details">
                            <div class="session-info">
                                <h4>Thông tin buổi học</h4>
                                <p><strong>Thời gian:</strong> 8:00 - 9:30</p>
                                <p><strong>Môn học:</strong> Toán 10A1 - Đại số</p>
                                <p><strong>Phòng:</strong> A101</p>
                                <p><strong>Số học sinh:</strong> 45</p>
                                <p><strong>Trạng thái:</strong> Đã hoàn thành</p>
                            </div>
                            <div class="session-comments">
                                <h4>Nhận xét</h4>
                                <div class="comment-item">
                                    <p>Học sinh tham gia tích cực, hiểu bài tốt</p>
                                    <small>12/10/2025 9:30</small>
                                </div>
                                <div class="comment-item">
                                    <p>Cần chú ý thêm về phần giải phương trình</p>
                                    <small>12/10/2025 9:25</small>
                                </div>
                            </div>
                            <div class="session-homework">
                                <h4>Bài tập về nhà</h4>
                                <ul>
                                    <li>Làm bài tập 1-10 trang 45</li>
                                    <li>Ôn tập chương 2</li>
                                    <li>Chuẩn bị kiểm tra 15 phút</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            showNotification(`Đang hiển thị chi tiết buổi học ${sessionId}!`, 'info');
        };
        
        window.addSessionComment = function() {
            console.log('addSessionComment called');
            const comment = prompt('Nhập nhận xét buổi học:');
            if (comment) {
                showNotification('Đã thêm nhận xét buổi học!', 'success');
            }
        };
        
        window.addHomework = function() {
            console.log('addHomework called');
            const homework = prompt('Nhập bài tập về nhà:');
            if (homework) {
                showNotification('Đã thêm bài tập về nhà!', 'success');
            }
        };
        
        window.exportSessionReport = function() {
            console.log('exportSessionReport called');
            const csvContent = `Báo cáo buổi học - ${new Date().toLocaleDateString('vi-VN')}
Thời gian,Môn học,Phòng,Số học sinh,Trạng thái,Nhận xét
8:00-9:30,Toán 10A1 - Đại số,A101,45,Đã hoàn thành,Học sinh tham gia tích cực`;
            
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            link.setAttribute('href', url);
            link.setAttribute('download', `bao_cao_buoi_hoc_${new Date().toISOString().split('T')[0]}.csv`);
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            showNotification('Đã xuất báo cáo buổi học!', 'success');
        };
        
        window.addNewSession = function() {
            console.log('addNewSession called');
            showNotification('Đã thêm buổi học mới!', 'success');
        };
        
        window.createAssignmentForClass = function() {
            console.log('createAssignmentForClass called');
            showNotification('Đã tạo bài tập cho lớp!', 'success');
        };
        
        window.getCurrentClassId = function() {
            console.log('getCurrentClassId called');
            return 1; // Default class ID
        };
        
        window.getSessionStatusText = function(status) {
            console.log('getSessionStatusText called with:', status);
            const statusTexts = {
                'completed': 'Đã học',
                'upcoming': 'Chưa học',
                'active': 'Đang học'
            };
            return statusTexts[status] || 'Không xác định';
        };
        
        window.getAttendanceStatusText = function(status) {
            console.log('getAttendanceStatusText called with:', status);
            const statusTexts = {
                'present': 'Có mặt',
                'absent': 'Vắng mặt',
                'late': 'Muộn'
            };
            return statusTexts[status] || 'Không xác định';
        };
        
        window.updateScheduleCalendar = function() {
            console.log('Updating schedule calendar...');
            const now = new Date();
            const currentMonth = now.getMonth();
            const currentYear = now.getFullYear();
            const currentDate = now.getDate();
            
            // Update calendar header
            const monthNames = [
                'Tháng 1', 'Tháng 2', 'Tháng 3', 'Tháng 4', 'Tháng 5', 'Tháng 6',
                'Tháng 7', 'Tháng 8', 'Tháng 9', 'Tháng 10', 'Tháng 11', 'Tháng 12'
            ];
            
            const calendarHeader = document.querySelector('.calendar-header');
            if (calendarHeader) {
                calendarHeader.textContent = `${monthNames[currentMonth]}, ${currentYear}`;
            }
            
            // Update today's schedule header
            const todayScheduleHeader = document.querySelector('.schedule-header h3');
            if (todayScheduleHeader) {
                todayScheduleHeader.textContent = `Lịch dạy hôm nay (${currentDate}/${currentMonth + 1}/${currentYear})`;
            }
            
            // Also update any other schedule headers
            const allScheduleHeaders = document.querySelectorAll('h3');
            allScheduleHeaders.forEach(header => {
                if (header.textContent.includes('Lịch dạy hôm nay')) {
                    header.textContent = `Lịch dạy hôm nay (${currentDate}/${currentMonth + 1}/${currentYear})`;
                }
            });
            
            // Highlight current date in calendar
            const calendarDays = document.querySelectorAll('.calendar-day');
            calendarDays.forEach(day => {
                day.classList.remove('today');
                if (parseInt(day.textContent) === currentDate) {
                    day.classList.add('today');
                }
            });
            
            console.log('Schedule calendar updated to current month:', currentMonth + 1, currentYear);
        };
        
        window.updateTodaysSchedule = function() {
            console.log('Updating today\'s schedule...');
            const now = new Date();
            const currentHour = now.getHours();
            const currentMinute = now.getMinutes();
            const currentTime = currentHour * 60 + currentMinute;
            
            // Real schedule data for today (12/10/2025)
            const todaySchedule = [
                {
                    id: 1,
                    time: '8:00 - 9:30',
                    subject: 'Toán 10A1 - Đại số',
                    room: 'Phòng A101',
                    students: 45,
                    startTime: 8 * 60, // 8:00 AM
                    endTime: 9 * 60 + 30 // 9:30 AM
                },
                {
                    id: 2,
                    time: '10:00 - 11:30',
                    subject: 'Toán 11B2 - Hình học',
                    room: 'Phòng B205',
                    students: 42,
                    startTime: 10 * 60, // 10:00 AM
                    endTime: 11 * 60 + 30 // 11:30 AM
                },
                {
                    id: 3,
                    time: '14:00 - 15:30',
                    subject: 'Toán 12C1 - Luyện đề',
                    room: 'Phòng C301',
                    students: 38,
                    startTime: 14 * 60, // 2:00 PM
                    endTime: 15 * 60 + 30 // 3:30 PM
                }
            ];
            
            // Update schedule list with real data
            const scheduleList = document.querySelector('.schedule-list');
            if (scheduleList) {
                scheduleList.innerHTML = todaySchedule.map(schedule => {
                    let status, statusClass, buttonText, buttonIcon, buttonClass;
                    
                    if (currentTime >= schedule.startTime && currentTime <= schedule.endTime) {
                        // Currently teaching
                        status = 'Đang dạy';
                        statusClass = 'active';
                        buttonText = 'Tạm dừng';
                        buttonIcon = 'pause';
                        buttonClass = 'btn-primary';
                    } else if (currentTime < schedule.startTime) {
                        // Upcoming
                        status = 'Sắp tới';
                        statusClass = 'upcoming';
                        buttonText = 'Bắt đầu';
                        buttonIcon = 'play';
                        buttonClass = 'btn-primary';
                    } else {
                        // Completed
                        status = 'Đã hoàn thành';
                        statusClass = 'completed';
                        buttonText = 'Xem kết quả';
                        buttonIcon = 'check';
                        buttonClass = 'btn-secondary';
                    }
                    
                    return `
                        <div class="schedule-item">
                            <div class="schedule-time">${schedule.time}</div>
                            <div class="schedule-duration">90 phút</div>
                            <div class="schedule-info">
                                <h4>${schedule.subject}</h4>
                                <div class="schedule-meta">
                                    <span class="schedule-location">
                                        <i class="fas fa-map-marker-alt"></i> ${schedule.room}
                                    </span>
                                    <span class="schedule-students">
                                        <i class="fas fa-users"></i> ${schedule.students} học sinh
                                    </span>
                                </div>
                            </div>
                            <div class="schedule-status">
                                <div class="status-badge ${statusClass}">${status}</div>
                                <div class="schedule-actions">
                                    <button class="btn ${buttonClass}" onclick="handleScheduleAction(${schedule.id}, '${status}')">
                                        <i class="fas fa-${buttonIcon}"></i> ${buttonText}
                                    </button>
                                    <button class="btn btn-outline" onclick="viewClassDetails(${schedule.id})">
                                        <i class="fas fa-info"></i> Chi tiết
                                    </button>
                                </div>
                            </div>
                        </div>
                    `;
                }).join('');
            }
            
            console.log('Today\'s schedule updated with real data based on current time:', currentTime);
        };
        
        // Handle schedule actions
        window.handleScheduleAction = function(scheduleId, status) {
            console.log('Handling schedule action for:', scheduleId, 'status:', status);
            
            if (status === 'Đang dạy') {
                pauseClass(scheduleId);
            } else if (status === 'Sắp tới') {
                startClass(scheduleId);
            } else if (status === 'Đã hoàn thành') {
                viewClassResults(scheduleId);
            }
        };
        
        window.startClass = function(classId) {
            console.log('Starting class:', classId);
            
            // Update class status to active
            const scheduleItem = document.querySelector(`[onclick*="handleScheduleAction(${classId}"]`)?.closest('.schedule-item');
            if (scheduleItem) {
                const statusBadge = scheduleItem.querySelector('.status-badge');
                const startBtn = scheduleItem.querySelector('.btn-primary');
                
                if (statusBadge) {
                    statusBadge.textContent = 'Đang dạy';
                    statusBadge.className = 'status-badge active';
                }
                if (startBtn) {
                    startBtn.innerHTML = '<i class="fas fa-pause"></i> Tạm dừng';
                    startBtn.onclick = () => pauseClass(classId);
                }
            }
            
            showNotification('Lớp học đã được bắt đầu!', 'success');
        };
        
        window.pauseClass = function(classId) {
            console.log('Pausing class:', classId);
            
            // Update class status to paused
            const scheduleItem = document.querySelector(`[onclick*="handleScheduleAction(${classId}"]`)?.closest('.schedule-item');
            if (scheduleItem) {
                const statusBadge = scheduleItem.querySelector('.status-badge');
                const startBtn = scheduleItem.querySelector('.btn-primary');
                
                if (statusBadge) {
                    statusBadge.textContent = 'Tạm dừng';
                    statusBadge.className = 'status-badge upcoming';
                }
                if (startBtn) {
                    startBtn.innerHTML = '<i class="fas fa-play"></i> Tiếp tục';
                    startBtn.onclick = () => startClass(classId);
                }
            }
            
            showNotification('Lớp học đã được tạm dừng!', 'info');
        };
        
        window.viewClassResults = function(classId) {
            console.log('Viewing class results:', classId);
            
            // Show class results modal
            const modal = document.createElement('div');
            modal.className = 'modal active';
            modal.innerHTML = `
                <div class="modal-content">
                    <div class="modal-header">
                        <h3>Kết quả lớp học ${classId}</h3>
                        <button class="modal-close" onclick="this.closest('.modal').remove()">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    <div class="modal-body">
                        <div class="class-results">
                            <div class="result-stats">
                                <div class="stat-item">
                                    <div class="stat-value">45</div>
                                    <div class="stat-label">Tổng học sinh</div>
                                </div>
                                <div class="stat-item">
                                    <div class="stat-value">42</div>
                                    <div class="stat-label">Có mặt</div>
                                </div>
                                <div class="stat-item">
                                    <div class="stat-value">3</div>
                                    <div class="stat-label">Vắng mặt</div>
                                </div>
                                <div class="stat-item">
                                    <div class="stat-value">93%</div>
                                    <div class="stat-label">Tỷ lệ tham gia</div>
                                </div>
                            </div>
                            <div class="result-actions">
                                <button class="btn btn-primary" onclick="exportClassResults(${classId})">
                                    <i class="fas fa-download"></i> Xuất kết quả
                                </button>
                                <button class="btn btn-success" onclick="openClassManagement(${classId})">
                                    <i class="fas fa-edit"></i> Chỉnh sửa
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            showNotification('Đang hiển thị kết quả lớp học!', 'info');
        };
        
        window.exportClassResults = function(classId) {
            console.log('Exporting class results:', classId);
            
            const csvContent = `Kết quả lớp học ${classId} - ${new Date().toLocaleDateString('vi-VN')}
Học sinh,Trạng thái,Điểm danh,Ghi chú
Nguyễn Văn A,Có mặt,8:00,
Trần Thị B,Có mặt,8:05,
Lê Văn C,Vắng mặt,,
Phạm Thị D,Có mặt,8:02,`;
            
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            link.setAttribute('href', url);
            link.setAttribute('download', `ket_qua_lop_${classId}_${new Date().toISOString().split('T')[0]}.csv`);
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            showNotification('Kết quả lớp học đã được xuất!', 'success');
        };
        
        // Real Export Functions
        window.exportSchedule = function() {
            console.log('Exporting schedule...');
            
            // Create CSV content
            const csvContent = `Lịch dạy - ${new Date().toLocaleDateString('vi-VN')}
Thời gian,Môn học,Lớp,Phòng,Số học sinh,Trạng thái
8:00-9:30,Toán 10A1 - Đại số,10A1,Phòng A101,45,Đang dạy
10:00-11:30,Toán 11B2 - Hình học,11B2,Phòng B205,42,Sắp tới
14:00-15:30,Toán 12C1 - Luyện đề,12C1,Phòng C301,38,Đã hoàn thành`;
            
            // Create and download file
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            link.setAttribute('href', url);
            link.setAttribute('download', `lich_day_${new Date().toISOString().split('T')[0]}.csv`);
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            alert('Lịch dạy đã được xuất thành công!');
        };
        
        window.exportGrades = function() {
            console.log('Exporting grades...');
            
            // Create CSV content
            const csvContent = `Báo cáo điểm số - ${new Date().toLocaleDateString('vi-VN')}
Lớp,Học sinh,Điểm kiểm tra,Điểm thi,Điểm trung bình,Xếp loại
10A1,Nguyễn Văn A,8.5,9.0,8.75,Giỏi
10A1,Trần Thị B,7.0,8.0,7.5,Khá
10A1,Lê Văn C,6.5,7.0,6.75,Trung bình`;
            
            // Create and download file
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            link.setAttribute('href', url);
            link.setAttribute('download', `bao_cao_diem_${new Date().toISOString().split('T')[0]}.csv`);
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            alert('Báo cáo điểm số đã được xuất thành công!');
        };
        
        window.exportReport = function() {
            console.log('Exporting report...');
            
            // Create PDF-like content (simplified)
            const reportContent = `BÁO CÁO TỔNG HỢP - ${new Date().toLocaleDateString('vi-VN')}
            
THỐNG KÊ LỚP HỌC:
- Tổng số lớp: 3
- Tổng số học sinh: 125
- Điểm trung bình: 8.2
- Học sinh giỏi: 15
- Cần cải thiện: 8

CHI TIẾT TỪNG LỚP:
Lớp 10A1: 45 học sinh, ĐTB: 8.5, Tỷ lệ tham gia: 95%
Lớp 11B2: 42 học sinh, ĐTB: 8.0, Tỷ lệ tham gia: 92%
Lớp 12C1: 38 học sinh, ĐTB: 8.1, Tỷ lệ tham gia: 90%`;
            
            // Create and download file
            const blob = new Blob([reportContent], { type: 'text/plain;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            link.setAttribute('href', url);
            link.setAttribute('download', `bao_cao_tong_hop_${new Date().toISOString().split('T')[0]}.txt`);
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            alert('Báo cáo đã được xuất thành công!');
        };
        
        // Real Modal Functions
        window.openClassManagement = function(classId) {
            console.log('Opening class management for class:', classId);
            
            const classNames = {
                1: 'Toán 10A1',
                2: 'Toán 11B2', 
                3: 'Toán 12C1'
            };
            
            const className = classNames[classId] || `Lớp ${classId}`;
            const titleElement = document.getElementById('classManagementTitle');
            if (titleElement) {
                titleElement.textContent = `Quản lý lớp học - ${className}`;
            }
            
            // Show modal first
            const modal = document.getElementById('classManagementModal');
            console.log('Modal found:', modal);
            if (modal) {
                modal.classList.add('active');
                document.body.style.overflow = 'hidden';
                console.log('Class management modal shown');
                
                // Load management data after modal is shown
                setTimeout(() => {
                    loadClassManagementData(classId);
                }, 100);
            } else {
                console.error('Modal not found!');
                showNotification('Lỗi: Không tìm thấy modal quản lý lớp!', 'error');
            }
        };
        
        window.loadClassManagementData = function(classId) {
            console.log('Loading class management data for class:', classId);
            
            // Load attendance data
            console.log('Loading attendance data...');
            loadAttendanceData(classId);
            
            // Load grading data
            console.log('Loading grading data...');
            loadGradingData(classId);
            
            // Load evaluation data
            console.log('Loading evaluation data...');
            loadEvaluationData(classId);
            
            // Set active tab to attendance by default
            console.log('Setting active tab to attendance...');
            showManagementTab('attendance');
        };
        
        window.toggleAttendance = function(studentId) {
            console.log('Toggling attendance for student:', studentId);
            const statusElement = event.target;
            const currentStatus = statusElement.textContent;
            
            let newStatus, newClass;
            if (currentStatus === 'Có mặt') {
                newStatus = 'Vắng mặt';
                newClass = 'absent';
            } else if (currentStatus === 'Vắng mặt') {
                newStatus = 'Muộn';
                newClass = 'late';
            } else {
                newStatus = 'Có mặt';
                newClass = 'present';
            }
            
            statusElement.textContent = newStatus;
            statusElement.className = `attendance-status ${newClass}`;
            
            // Update attendance statistics
            updateAttendanceStats();
            
            // Show success notification
            showNotification(`Đã cập nhật trạng thái học sinh ${studentId} thành: ${newStatus}`, 'success');
        };
        
        window.updateGrade = function(studentId, grade) {
            console.log('Updating grade for student:', studentId, 'to:', grade);
            
            // Validate grade
            if (grade < 0 || grade > 10) {
                showNotification('Điểm số phải từ 0 đến 10', 'error');
                return;
            }
            
            // Update grade statistics
            updateGradeStats();
            
            // Show success notification
            showNotification(`Đã cập nhật điểm học sinh ${studentId} thành: ${grade}`, 'success');
        };
        
        // Notification system
        window.showNotification = function(message, type = 'info') {
            const notification = document.createElement('div');
            notification.className = `notification notification-${type}`;
            notification.innerHTML = `
                <div class="notification-content">
                    <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'error' ? 'exclamation-circle' : 'info-circle'}"></i>
                    <span>${message}</span>
                </div>
                <button class="notification-close" onclick="this.parentElement.remove()">
                    <i class="fas fa-times"></i>
                </button>
            `;
            
            // Add to page
            document.body.appendChild(notification);
            
            // Auto remove after 3 seconds
            setTimeout(() => {
                if (notification.parentElement) {
                    notification.remove();
                }
            }, 3000);
        };
        
        // Update statistics
        window.updateAttendanceStats = function() {
            const attendanceItems = document.querySelectorAll('.attendance-item');
            let presentCount = 0;
            let absentCount = 0;
            let lateCount = 0;
            
            attendanceItems.forEach(item => {
                const status = item.querySelector('.attendance-status').textContent;
                if (status === 'Có mặt') presentCount++;
                else if (status === 'Vắng mặt') absentCount++;
                else if (status === 'Muộn') lateCount++;
            });
            
            const total = presentCount + absentCount + lateCount;
            const attendanceRate = total > 0 ? Math.round((presentCount / total) * 100) : 0;
            
            // Update attendance rate in class card
            const attendanceRateElement = document.querySelector('.class-stats .stat-item:last-child .stat-value');
            if (attendanceRateElement) {
                attendanceRateElement.textContent = `${attendanceRate}% THAM GIA`;
            }
        };
        
        window.updateGradeStats = function() {
            const gradeInputs = document.querySelectorAll('.grade-input');
            let totalGrade = 0;
            let validGrades = 0;
            
            gradeInputs.forEach(input => {
                const grade = parseFloat(input.value);
                if (!isNaN(grade) && grade >= 0 && grade <= 10) {
                    totalGrade += grade;
                    validGrades++;
                }
            });
            
            const averageGrade = validGrades > 0 ? (totalGrade / validGrades).toFixed(1) : 0;
            
            // Update average grade in class card
            const averageGradeElement = document.querySelector('.class-stats .stat-item:nth-child(2) .stat-value');
            if (averageGradeElement) {
                averageGradeElement.textContent = `${averageGrade} ĐIỂM TB`;
            }
        };
        
        window.viewStudentDetails = function(studentId) {
            console.log('viewStudentDetails called with:', studentId);
            showNotification(`Xem chi tiết học sinh ${studentId}`, 'info');
        };
        
        window.editStudentDetails = function(studentId) {
            console.log('editStudentDetails called with:', studentId);
            showNotification(`Chỉnh sửa học sinh ${studentId}`, 'info');
        };
        
        window.addStudentToClass = function() {
            console.log('addStudentToClass called');
            showNotification('Thêm học sinh vào lớp', 'info');
        };
        
        window.importStudentsToClass = function() {
            console.log('importStudentsToClass called');
            showNotification('Import học sinh vào lớp', 'info');
        };
        
        window.closeStudentsModal = function() {
            console.log('closeStudentsModal called');
            const modal = document.getElementById('studentsModal');
            if (modal) {
                modal.classList.remove('active');
                showNotification('Đã đóng modal học sinh!', 'info');
            }
        };
        
        window.closeClassDetailsModal = function() {
            console.log('closeClassDetailsModal called');
            const modal = document.getElementById('classDetailsModal');
            if (modal) {
                modal.classList.remove('active');
                showNotification('Đã đóng modal chi tiết lớp!', 'info');
            }
        };
        
        window.closeClassManagementModal = function() {
            console.log('closeClassManagementModal called');
            const modal = document.getElementById('classManagementModal');
            if (modal) {
                modal.classList.remove('active');
                showNotification('Đã đóng modal quản lý lớp!', 'info');
            }
        };
        
        window.closeSessionDetailsModal = function() {
            console.log('closeSessionDetailsModal called');
            const modal = document.getElementById('sessionDetailsModal');
            if (modal) {
                modal.classList.remove('active');
                showNotification('Đã đóng modal chi tiết buổi học!', 'info');
            }
        };
        
        console.log('All functions defined successfully!');
        
        // Force update current date and time
        const now = new Date();
        console.log('Current date and time:', now);
        
        const timeElement = document.getElementById('currentTime');
        const dateElement = document.getElementById('currentDate');
        
        if (timeElement) {
            const timeString = now.toLocaleTimeString('vi-VN', { 
                hour: '2-digit', 
                minute: '2-digit',
                hour12: false 
            });
            timeElement.textContent = timeString;
            console.log('Time updated:', timeString);
        }
        
        if (dateElement) {
            dateElement.textContent = now.toLocaleDateString('vi-VN');
            console.log('Date updated:', now.toLocaleDateString('vi-VN'));
        }
        
        // Update time every minute (60000ms)
        setInterval(() => {
            const now = new Date();
            const timeElement = document.getElementById('currentTime');
            if (timeElement) {
                const timeString = now.toLocaleTimeString('vi-VN', { 
                    hour: '2-digit', 
                    minute: '2-digit',
                    hour12: false 
                });
                timeElement.textContent = timeString;
            }
        }, 60000);
        
        // Update schedule calendar to current month
        updateScheduleCalendar();
        
        // Update today's schedule section
        updateTodaysSchedule();
        
        // Add click outside to close modal functionality
        document.addEventListener('click', function(event) {
            // Close modals when clicking outside
            if (event.target.classList.contains('modal')) {
                event.target.classList.remove('active');
            }
        });
        
        // Add missing showClassTab function
        window.showClassTab = function(tabName) {
            console.log('showClassTab called with:', tabName);
            
            // Remove active class from all tabs
            const tabs = document.querySelectorAll('.class-details-tabs .tab-btn');
            tabs.forEach(tab => tab.classList.remove('active'));
            
            // Add active class to clicked tab
            const clickedTab = event.target.closest('.tab-btn');
            if (clickedTab) {
                clickedTab.classList.add('active');
            }
            
            // Show corresponding content
            const contents = document.querySelectorAll('.tab-content');
            contents.forEach(content => content.style.display = 'none');
            
            const targetContent = document.getElementById(tabName + 'Tab');
            if (targetContent) {
                targetContent.style.display = 'block';
            }
            
            // Load data for the tab
            if (tabName === 'students') {
                loadClassStudentsData(1);
            } else if (tabName === 'assignments') {
                loadClassAssignmentsData(1);
            }
            
            showNotification(`Đã chuyển sang tab ${tabName}`, 'info');
        };
        
        // Add escape key to close modals
        document.addEventListener('keydown', function(event) {
            if (event.key === 'Escape') {
                const activeModal = document.querySelector('.modal.active');
                if (activeModal) {
                    activeModal.classList.remove('active');
                    showNotification('Đã đóng modal!', 'info');
                }
            }
        });
        
        console.log('=== DEBUG SCRIPT COMPLETED ===');
        }
    </script>
</body>
</html>